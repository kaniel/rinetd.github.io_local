<!doctype html><html lang=zh-cn class=no-js><title>【YOLO】详解：YOLO-darknet训练自己的数据</title><meta charset=utf-8><meta name=robots content=index,nofollow><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta http-equiv=x-dns-prefetch-control content=on><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content=origin-when-cross-origin><meta name=description content="【目标检测一】YOLOV3从训练、测试到批量保存测试结果_人工智能_gusui7202的博客-CSDN博客 目标检测：YOLOv3: 训练自己的"><meta name=author content=rinetd><meta name=google-site-verification content=ifeWsnNpU7w8vP3ii_Cjq-P9LKw3ngVitnMWv4XmJqk><link rel=canonical href=../../../ai/yolo/yolov3-train/><link rel=icon href=../../../public/favicon.ico><link rel="shortcut icon" href=../../../public/favicon.ico><link rel=stylesheet href=../../../front/css/main.min.css><link href=https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css rel=stylesheet><link rel=stylesheet href=//cdn.bootcss.com/video.js/6.2.8/alt/video-js-cdn.min.css><body class="single single-post single-format-standard col-3cm full-width topbar-enabled chrome"><div id=wrapper><header id=header class="top-menu-mobile-on one-mobile-menu top_menu header-ads-desktop  topbar-transparent"><nav class="nav-container group mobile-menu mobile-sticky" id=nav-mobile data-menu-id=header-1><div class=mobile-title-logo-in-header><p class=site-title><a class=custom-logo-link href rel=home title="Pytool | Home">Pytool</a></div><div class="ham__navbar-toggler-two collapsed" title=Menu aria-expanded=false><div class=ham__navbar-span-wrapper><span class="line line-1"></span><span class="line line-2"></span><span class="line line-3"></span></div></div><div class=nav-text>【YOLO】详解：YOLO-darknet训练自己的数据</div><div class="nav-wrap container"><ul class="nav container-inner group mobile-search"><li><form class="searchform themeform" action=https://demo-hueman.presscustomizr.com/><div><input class=search name=s onblur="if(this.value=='')this.value='To search type and hit enter';" onfocus="if(this.value=='To search type and hit enter')this.value='';" value="To search type and hit enter"></div></form></ul><ul id=menu-topbar-menu class="nav container-inner group"><li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home"><a href>Home</a><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../wechat/>Wechat</a><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../hardware/>Hardware</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hardware/kernel/>Kernel</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hardware/hisilicon/>Hisilicon</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hardware/rtmp/>Rtmp</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hardware/rk3399/>Rk3399</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hardware/dts/>Dts</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hardware/rk3288/>Rk3288</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hardware/%E8%BD%A6%E8%81%94%E7%BD%91/>车联网</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hardware/android-%E5%BA%95%E5%B1%82/>Android-底层</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../language/>Language</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../language/clang/>Clang</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../language/golang/>Golang</a><ul class=sub-menu><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=../../../language/golang/cgo/>Cgo</a><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=../../../language/golang/hugo/>Hugo</a><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=../../../language/golang/sys/>Sys</a><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=../../../language/golang/goher/>Goher</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../language/cpp/>Cpp</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../language/python/>Python</a><ul class=sub-menu><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=../../../language/python/scrapy/>Scrapy</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../language/java/>Java</a><ul class=sub-menu><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=../../../language/java/hadoop/>Hadoop</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../language/awesome/>Awesome</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../language/php/>Php</a><ul class=sub-menu><li class="menu-item menu-item-type-custom menu-item-object-custom"><a href=../../../language/php/magento/>Magento</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../language/android/>Android</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../linux/>Linux</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../linux/shell/>Shell</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../linux/cmd/>Cmd</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../linux/nginx/>Nginx</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../linux/ip/>Ip</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../linux/git/>Git</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../linux/haproxy/>Haproxy</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../linux/lvs/>Lvs</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../macos/>Macos</a><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../ai/>Ai</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../ai/yolo/>Yolo</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../ai/caffe/>Caffe</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../ai/math/>Math</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../ai/ncnn/>Ncnn</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../ai/dataset/>Dataset</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../ai/pytorch/>Pytorch</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../frontend/>Frontend</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../frontend/css/>Css</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../frontend/vue/>Vue</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../devops/>Devops</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/docker/>Docker</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/elk/>Elk</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/ansible/>Ansible</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/prometheus/>Prometheus</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/drone/>Drone</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/kubernetes/>Kubernetes</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/oauth2/>OAuth2</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/etcd/>Etcd</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/apidoc/>Apidoc</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../devops/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/>系统监控</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../database/>Database</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../database/mysql/>Mysql</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../database/mongo/>Mongo</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../database/redis/>Redis</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../windows/>Windows</a><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../hacker/>Hacker</a><ul class=sub-menu><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hacker/01_%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/>01_端口扫描</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hacker/00_%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%9A%A7%E9%81%93/>00_端口转发(隧道)</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hacker/01-info-gather/>01-Info-Gather</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hacker/02-spoof/>02-Spoof</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../hacker/shells/>Shells</a></ul><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../work/>Work</a><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children"><a href=../../../edit/>Edit</a><li class=item><a class=text href=../../../series/>series</a><li class=item><a class=text href=../../../categories/>categories</a><li class=item><a class=text href=../../../tags/>tags</a><li class=item><a class=text href=../../../me/>about</a></ul></div></nav><nav class="nav-container group desktop-menu desktop-sticky" id=nav-topbar data-menu-id=header-2><div class=nav-text>【YOLO】详解：YOLO-darknet训练自己的数据</div><div class=topbar-toggle-down><i class="fas fa-angle-double-down" aria-hidden=true data-toggle=down title="Expand menu"></i><i class="fas fa-angle-double-up" aria-hidden=true data-toggle=up title="Collapse menu"></i></div><div class="nav-wrap container"><ul id=menu-topbar-menu-1 class="nav container-inner group"><li class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item current_page_item menu-item-home"><a href=../../../>Home</a><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../wechat/>Wechat</a><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../hardware/>Hardware</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hardware/kernel/>Kernel</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hardware/hisilicon/>Hisilicon</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hardware/rtmp/>Rtmp</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hardware/rk3399/>Rk3399</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hardware/dts/>Dts</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hardware/rk3288/>Rk3288</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hardware/%E8%BD%A6%E8%81%94%E7%BD%91/>车联网</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hardware/android-%E5%BA%95%E5%B1%82/>Android-底层</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../language/>Language</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../language/clang/>Clang</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../language/golang/>Golang</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../language/cpp/>Cpp</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../language/python/>Python</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../language/java/>Java</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../language/awesome/>Awesome</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../language/php/>Php</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../language/android/>Android</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../linux/>Linux</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../linux/shell/>Shell</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../linux/cmd/>Cmd</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../linux/nginx/>Nginx</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../linux/ip/>Ip</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../linux/git/>Git</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../linux/haproxy/>Haproxy</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../linux/lvs/>Lvs</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../macos/>Macos</a><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../post/>Post</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../post/english/>English</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../post/seo/>Seo</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../post/life/>Life</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../post/wiki/>Wiki</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../post/software/>Software</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../post/basic/>Basic</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../post/reship/>Reship</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../ai/>Ai</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../ai/yolo/>Yolo</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../ai/caffe/>Caffe</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../ai/math/>Math</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../ai/ncnn/>Ncnn</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../ai/dataset/>Dataset</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../ai/pytorch/>Pytorch</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../frontend/>Frontend</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../frontend/css/>Css</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../frontend/vue/>Vue</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../devops/>Devops</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/docker/>Docker</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/elk/>Elk</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/ansible/>Ansible</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/prometheus/>Prometheus</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/drone/>Drone</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/kubernetes/>Kubernetes</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/oauth2/>OAuth2</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/etcd/>Etcd</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/apidoc/>Apidoc</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../devops/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/>系统监控</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../database/>Database</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../database/mysql/>Mysql</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../database/mongo/>Mongo</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../database/redis/>Redis</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../windows/>Windows</a><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../hacker/>Hacker</a><ul class=sub-menu><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hacker/01_%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F/>01_端口扫描</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hacker/00_%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E9%9A%A7%E9%81%93/>00_端口转发(隧道)</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hacker/01-info-gather/>01-Info-Gather</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hacker/02-spoof/>02-Spoof</a><li class="menu-item menu-item-type-taxonomy menu-item-object-post_tag"><a href=../../../hacker/shells/>Shells</a></ul><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../work/>Work</a><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children"><a href=../../../edit/>Edit</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../series/>series</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../categories/>categories</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../tags/>tags</a><li class="menu-item menu-item-type-post_type menu-item-object-page"><a href=../../../me/>about</a></ul></div></nav></header><div class=container id=page><div class=container-inner><div class=main><div class="main-inner group"><div class=content><div class="pad group page-title"><ul class="meta-single group"><li><span class="fa fa-folder-open"></span><li class=category><a href=../../../categories/yolo/ rel="category tag">yolo</a></ul></div><div class="pad group"><article class="post type-post status-publish format-standard has-post-thumbnail hentry category-lifestyle tag-classical-grid tag-masonry-grid tag-standard-list"><div class="post-inner group"><h1 class=post-title>【YOLO】详解：YOLO-darknet训练自己的数据</h1><p class=post-byline>by · 2019年12月10日 · 10698 Words ·
~22min reading time |
<a href=https://gitlab.com/rinetd/blog/edit/master/ai/yolo/yolov3-darknet-train.md target=_blank>Improve on <i class="fa fa-gitlab"></i></a><div class=clear></div><div class="entry themeform"><div class=entry-inner></br>原文链接：<a target=_blank href=../../../ai/yolo/yolov3-train/> 【YOLO】详解：YOLO-darknet训练自己的数据</a><p><a href=https://blog.csdn.net/gusui7202/article/details/83781719?depth_1- target=_blank>【目标检测一】YOLOV3从训练、测试到批量保存测试结果_人工智能_gusui7202的博客-CSDN博客</a><p><a href=https://blog.csdn.net/lilai619/article/details/79695109 target=_blank>目标检测：YOLOv3: 训练自己的数据 - 微风❤水墨</a><p><a href=https://blog.csdn.net/Jinlong_Xu/article/details/75577007 target=_blank>【YOLO】详解：YOLO-darknet训练自己的数据 - Jinlong_Xu的博客</a><p>准备训练数据<br>使用darknet训练自己的YOLO模型需要将数据转成darknet需要的格式，每张图片对应一个.txt的label文件，文件格式如下：<p><object-class><x><y><width><height><p>object-class是类的索引，后面的4个值都是相对于整张图片的比例。<br>x是ROI中心的x坐标，y是ROI中心的y坐标，width是ROI的宽，height是ROI的高。<p>我需要用到Pascal VOC、MSCOCO、ImageNet和自己标记的一些图片。<br>混用这些数据集有一个严重的问题，有一些需要标记的物体没有被标记。<br>如ImageNet的200种物体中有iPod并做了标记，而MSCOCO中有一些图片中有iPod却没有标记出来，这会导致模型的精度下降。该问题可以通过对这部分图片重新标记来解决（工作量很大）；也可以修改损失函数，对不同数据集的image计算不同的损失，同时针对不同数据集中的数据使用不同的object_scale和noobject_scale。<p>整合这些数据集首先要准备一个list，list中列出了要识别的物体。<br>如paul_list.txt<p>0,ambulance<br>1,apple<br>2,automat<br>3,backpack<br>4,baggage<br>5,banana<br>6,baseball<br>7,basketball<br>8,bed<br>9,bench<p>转换Pascal VOC<br>darknet作者提供了voc_label.py脚本来实现该功能，我们只需修改脚本中的classes为我们需要的classes即可，然后在VOCdevkit的父目录执行voc_label.py即可。<p>classes = [&quot;ambulance&quot;, &quot;apple&quot;, &quot;automat&quot;, &quot;backpack&quot;, &quot;baggage&quot;, &quot;banana&quot;, &quot;baseball&quot;, &quot;basketball&quot;, &quot;bed&quot;,&quot;bench&quot;]<p>转换MSCOCO<br>查看coco的80种物体有哪些是我们需要的，制作coco_list.txt，格式为,。如：<p>1,apple<br>3,backpack<br>5,banana<br>8,bed<br>9,bench<p>安装MSCOCO提供的Python API库，然后执行coco_label.py。<br>coco_label.py见github。<br><a href=https://github.com/PaulChongPeng/darknet/blob/master/tools/coco_label.py target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/tools/coco_label.py</a><p>执行脚本前需要修改dataDir和classes为自己的COCO数据集路径和coco_list.txt路径<h1 id=coding-utf-8>coding=utf-8</h1><h1 id=使用说明>使用说明</h1><h1 id=需要先安装coco-tools>需要先安装coco tools</h1><h1 id=git-clone-https-github-com-pdollar-coco-git>git clone <a href=https://github.com/pdollar/coco.git target=_blank>https://github.com/pdollar/coco.git</a></h1><h1 id=cd-coco-pythonapi>cd coco/PythonAPI</h1><h1 id=make-install-可能会缺少相关依赖-根据提示安装依赖即可>make install(可能会缺少相关依赖，根据提示安装依赖即可)</h1><h1 id=执行脚本前需在train2014和val2014目录下分别创建jpegimages和labels目录-并将原来train2014和val2014目录下的图片移到jpegimages下>执行脚本前需在train2014和val2014目录下分别创建JPEGImages和labels目录，并将原来train2014和val2014目录下的图片移到JPEGImages下</h1><h1 id=coco数据集的filelist目录下会生成图片路径列表>COCO数据集的filelist目录下会生成图片路径列表</h1><h1 id=coco数据集的子集的labels目录下会生成yolo需要的标注文件>COCO数据集的子集的labels目录下会生成yolo需要的标注文件</h1><p>from pycocotools.coco import COCO<br>import shutil<br>import os<h1 id=将roi的坐标转换为yolo需要的坐标>将ROI的坐标转换为yolo需要的坐标</h1><h1 id=size是图片的w和h>size是图片的w和h</h1><h1 id=box里保存的是roi的坐标-x-y的最大值和最小值>box里保存的是ROI的坐标（x，y的最大值和最小值）</h1><h1 id=返回值为roi中心点相对于图片大小的比例坐标-和roi的w-h相对于图片大小的比例>返回值为ROI中心点相对于图片大小的比例坐标，和ROI的w、h相对于图片大小的比例</h1><p>def convert(size, box):<pre><code>dw = 1. / size[0]
dh = 1. / size[1]
x = box[0] + box[2] / 2.0
y = box[1] + box[3] / 2.0
w = box[2]
h = box[3]
x = x * dw
w = w * dw
y = y * dh
h = h * dh
return (x, y, w, h)
</code></pre><h1 id=获取所需要的类名和id>获取所需要的类名和id</h1><h1 id=path为类名和id的对应关系列表的地址-标注文件中可能有很多类-我们只加载该path指向文件中的类>path为类名和id的对应关系列表的地址（标注文件中可能有很多类，我们只加载该path指向文件中的类）</h1><h1 id=返回值是一个字典-键名是类名-键值是id>返回值是一个字典，键名是类名，键值是id</h1><p>def get_classes_and_index(path):<pre><code>D = {}
f = open(path)
for line in f:
    temp = line.rstrip().split(',', 2)
    print(&quot;temp[0]:&quot; + temp[0] + &quot;\n&quot;)
    print(&quot;temp[1]:&quot; + temp[1] + &quot;\n&quot;)
    D[temp[1]] = temp[0]
return D
</code></pre><p>dataDir = '/mnt/large4t/pengchong<em>data/Data/COCO' # COCO数据集所在的路径<br>dataType = 'train2014' # 要转换的COCO数据集的子集名<br>annFile = '%s/annotations/instances</em>%s.json' % (dataDir, dataType) # COCO数据集的标注文件路径<br>classes = get_classes_and_index('/mnt/large4t/pengchong_data/Tools/Yolo_paul/darknet/data/coco_list.txt')<h1 id=labels-目录若不存在-创建labels目录-若存在-则清空目录>labels 目录若不存在，创建labels目录。若存在，则清空目录</h1><p>if not os.path.exists('%s/%s/labels/' % (dataDir, dataType)):<pre><code>os.makedirs('%s/%s/labels/' % (dataDir, dataType))
</code></pre><p>else:<pre><code>shutil.rmtree('%s/%s/labels/' % (dataDir, dataType))
os.makedirs('%s/%s/labels/' % (dataDir, dataType))
</code></pre><h1 id=filelist-目录若不存在-创建filelist目录>filelist 目录若不存在，创建filelist目录。</h1><p>if not os.path.exists('%s/filelist/' % dataDir):<pre><code>os.makedirs('%s/filelist/' % dataDir)
</code></pre><p>coco = COCO(annFile) # 加载解析标注文件<br>list_file = open('%s/filelist/%s.txt' % (dataDir, dataType), 'w') # 数据集的图片list保存路径<p>imgIds = coco.getImgIds() # 获取标注文件中所有图片的COCO Img ID<br>catIds = coco.getCatIds() # 获取标注文件总所有的物体类别的COCO Cat ID<p>for imgId in imgIds:<pre><code>objCount = 0  # 一个标志位，用来判断该img是否包含我们需要的标注
print('imgId :%s' % imgId)
Img = coco.loadImgs(imgId)[0]  # 加载图片信息
print('Img :%s' % Img)
filename = Img['file_name']  # 获取图片名
width = Img['width']  # 获取图片尺寸
height = Img['height']  # 获取图片尺寸
print('filename :%s, width :%s ,height :%s' % (filename, width, height))
annIds = coco.getAnnIds(imgIds=imgId, catIds=catIds, iscrowd=None)  # 获取该图片对应的所有COCO物体类别标注ID
print('annIds :%s' % annIds)
for annId in annIds:
    anns = coco.loadAnns(annId)[0]  # 加载标注信息
    catId = anns['category_id']  # 获取该标注对应的物体类别的COCO Cat ID
    cat = coco.loadCats(catId)[0]['name']  # 获取该COCO Cat ID对应的物体种类名
    # print 'anns :%s' % anns
    # print 'catId :%s , cat :%s' % (catId,cat)

    # 如果该类名在我们需要的物体种类列表中，将标注文件转换为YOLO需要的格式
    if cat in classes:
        objCount = objCount + 1
        out_file = open('%s/%s/labels/%s.txt' % (dataDir, dataType, filename[:-4]), 'a')
        cls_id = classes[cat]  # 获取该类物体在yolo训练中的id
        box = anns['bbox']
        size = [width, height]
        bb = convert(size, box)
        out_file.write(str(cls_id) + &quot; &quot; + &quot; &quot;.join([str(a) for a in bb]) + '\n')
        out_file.close()

if objCount &gt; 0:
    list_file.write('%s/%s/JPEGImages/%s\n' % (dataDir, dataType, filename))
</code></pre><p>list_file.close()<p>转换ImageNet<br>我使用的是ILSVRC2016的数据，查看200种物体中有哪些是我们需要的，然后制作imagenet_list.txt。<p>需要注意，ImageNet的标注文件中的object name使用的物体的WordNetID，所以imagenet_list.txt中需要使用WordNetID，如：<p>1,n07739125<br>3,n02769748<br>5,n07753592<br>6,n02799071<br>7,n02802426<br>9,n02828884<p>为了方便获取WordNetID在ImageNet中的物体名词（paul_list.txt中的名词未必和ImageNet中的一致），可以制作一个imagenet_map.txt，如：<p>1,apple,n07739125<br>3,backpack,n02769748<br>5,banana,n07753592<br>6,baseball,n02799071<br>7,basketball,n02802426<br>9,bench,n02828884<p>制作imagenet_list.txt和imagenet_map.txt需要知道WordNetID和名词间的映射关系，有两个办法。<p>离线版：<p>从ImageNet下载words.txt（WordNetID和名词间的映射）和gloss.txt（WordNetID对应的名词的定义）,然后查询。如果没有梯子，国内访问ImageNet龟速，文件被我备份在GitHub。<br><a href=https://github.com/PaulChongPeng/darknet/blob/32dddd8509de4bf57cad0aa330160d57d33d0c66/data/words.txt target=_blank>https://github.com/PaulChongPeng/darknet/blob/32dddd8509de4bf57cad0aa330160d57d33d0c66/data/words.txt</a><br><a href=https://github.com/PaulChongPeng/darknet/blob/32dddd8509de4bf57cad0aa330160d57d33d0c66/data/gloss.txt target=_blank>https://github.com/PaulChongPeng/darknet/blob/32dddd8509de4bf57cad0aa330160d57d33d0c66/data/gloss.txt</a><p>在线版：<p>访问 <a href=http://image-net.org/challenges/LSVRC/2015/browse-det-synsets target=_blank>http://image-net.org/challenges/LSVRC/2015/browse-det-synsets</a> 。请自备梯子，不然慢的令人发指。<p>点击需要查询的名词，如Volleyball，会跳转到对应的网页，我们需要的是网页地址后的wnid。如 <a href="http://imagenet.stanford.edu/synset?wnid=n04540053" target=_blank>http://imagenet.stanford.edu/synset?wnid=n04540053</a> 。<p>制作好list后，将imagenet_to_yolo.py放在ILSVRC2016/bject_detection/ILSVRC目录下，并将Data文件夹重命名为JPEGImages（因为darknet找图片对应的标记文件是直接替换JPEGImages为labels，图片后缀名替换为txt）。修改classes为自己的list路径后直接运行脚本即可。<p>imagenet_to_yolo.py 我放在了GitHub上：<p><a href=https://github.com/PaulChongPeng/darknet/blob/master/tools/imagenet_to_yolo.py target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/tools/imagenet_to_yolo.py</a><h1 id=coding-utf-8-1>coding=utf-8</h1><h1 id=使用说明-1>使用说明</h1><h1 id=将该文件放在ilsvrc2016-bject-detection-ilsvrc目录下-并将data文件夹重命名为jpegimages>将该文件放在ILSVRC2016/bject_detection/ILSVRC目录下，并将Data文件夹重命名为JPEGImages</h1><h1 id=执行该工具-lists目录下会生成图片路径列表>执行该工具，Lists目录下会生成图片路径列表</h1><h1 id=labels目录下会生成yolo需要的标注文件>labels目录下会生成yolo需要的标注文件</h1><p>import xml.etree.ElementTree as ET<br>import pickle<br>import os<br>from os import listdir, getcwd<br>from os.path import join<br>import shutil<h1 id=获取所有包含标注文件的的目录路径>获取所有包含标注文件的的目录路径</h1><p>def get_dirs():<pre><code>dirs = ['DET/train/ILSVRC2014_train_0006', 'DET/train/ILSVRC2014_train_0005', 'DET/train/ILSVRC2014_train_0004',
        'DET/train/ILSVRC2014_train_0003', 'DET/train/ILSVRC2014_train_0002', 'DET/train/ILSVRC2014_train_0001',
        'DET/train/ILSVRC2014_train_0000', 'DET/val']
dirs_2013 = os.listdir('JPEGImages/DET/train/ILSVRC2013_train/')
for dir_2013 in dirs_2013:
    dirs.append('DET/train/ILSVRC2013_train/' + dir_2013)
return dirs
</code></pre><h1 id=获取所需要的类名和id-1>获取所需要的类名和id</h1><h1 id=path为类名和id的对应关系列表的地址-标注文件中可能有很多类-我们只加载该path指向文件中的类-1>path为类名和id的对应关系列表的地址（标注文件中可能有很多类，我们只加载该path指向文件中的类）</h1><h1 id=返回值是一个字典-键名是类名-键值是id-1>返回值是一个字典，键名是类名，键值是id</h1><p>def get_classes_and_index(path):<pre><code>D = {}
f = open(path)
for line in f:
    temp = line.rstrip().split(',', 2)
    D[temp[1]] = temp[0]
return D
</code></pre><h1 id=将roi的坐标转换为yolo需要的坐标-1>将ROI的坐标转换为yolo需要的坐标</h1><h1 id=size是图片的w和h-1>size是图片的w和h</h1><h1 id=box里保存的是roi的坐标-x-y的最大值和最小值-1>box里保存的是ROI的坐标（x，y的最大值和最小值）</h1><h1 id=返回值为roi中心点相对于图片大小的比例坐标-和roi的w-h相对于图片大小的比例-1>返回值为ROI中心点相对于图片大小的比例坐标，和ROI的w、h相对于图片大小的比例</h1><p>def convert(size, box):<pre><code>dw = 1. / size[0]
dh = 1. / size[1]
x = (box[0] + box[1]) / 2.0
y = (box[2] + box[3]) / 2.0
w = box[1] - box[0]
h = box[3] - box[2]
x = x * dw
w = w * dw
y = y * dh
h = h * dh
return (x, y, w, h)
</code></pre><h1 id=将labelimg-生成的xml文件转换为yolo需要的txt文件>将labelImg 生成的xml文件转换为yolo需要的txt文件</h1><h1 id=image-dir-图片所在的目录的路径>image_dir 图片所在的目录的路径</h1><h1 id=image-id图片名>image_id图片名</h1><p>def convert_annotation(image_dir, image_id):<pre><code>in_file = open('Annotations/%s/%s.xml' % (image_dir, image_id))
obj_num = 0  # 一个标志位，用来判断该img是否包含我们需要的标注
tree = ET.parse(in_file)
root = tree.getroot()
size = root.find('size')
w = int(size.find('width').text)
h = int(size.find('height').text)

for obj in root.iter('object'):
    cls = obj.find('name').text
    if cls not in classes:
        continue
    obj_num = obj_num + 1
    if obj_num == 1:
        out_file = open('labels/%s/%s.txt' % (image_dir, image_id), 'w')
    cls_id = classes[cls]  # 获取该类物体在yolo训练中的id
    xmlbox = obj.find('bndbox')
    b = (float(xmlbox.find('xmin').text), float(xmlbox.find('xmax').text), float(xmlbox.find('ymin').text),
         float(xmlbox.find('ymax').text))
    bb = convert((w, h), b)
    out_file.write(str(cls_id) + &quot; &quot; + &quot; &quot;.join([str(a) for a in bb]) + '\n')

if obj_num &gt; 0:
    list_file = open('Lists/%s.txt' % image_dir.split('/')[-1], 'a')  # 数据集的图片list保存路径
    list_file.write('%s/JPEGImages/%s/%s.JPEG\n' % (wd, image_dir, image_id))
    list_file.close()
</code></pre><p>def IsSubString(SubStrList, Str):<pre><code>flag = True
for substr in SubStrList:
    if not (substr in Str):
        flag = False

return flag
</code></pre><h1 id=获取findpath路径下指定格式-flagstr-的文件名-不包含后缀名-列表>获取FindPath路径下指定格式（FlagStr）的文件名（不包含后缀名）列表</h1><p>def GetFileList(FindPath, FlagStr=[]):<pre><code>import os
FileList = []
FileNames = os.listdir(FindPath)
if (len(FileNames) &gt; 0):
    for fn in FileNames:
        if (len(FlagStr) &gt; 0):
            if (IsSubString(FlagStr, fn)):
                FileList.append(fn[:-4])
        else:
            FileList.append(fn)

if (len(FileList) &gt; 0):
    FileList.sort()

return FileList
</code></pre><p>classes = get_classes_and_index('/mnt/large4t/pengchong_data/Tools/Yolo_paul/darknet/data/imagenet_list.txt')<br>dirs = get_dirs()<p>wd = getcwd()<h1 id=lists-目录若不存在-创建lists目录-若存在-则清空目录>Lists 目录若不存在，创建Lists目录。若存在，则清空目录</h1><p>if not os.path.exists('Lists/'):<pre><code>os.makedirs('Lists/')
</code></pre><p>else:<pre><code>shutil.rmtree('Lists/')
os.makedirs('Lists/')
</code></pre><p>for image_dir in dirs:<pre><code>if not os.path.exists('JPEGImages/' + image_dir):
    print(&quot;JPEGImages/%s dir not exist&quot; % image_dir)
    continue
# labels 目录若不存在，创建labels目录。若存在，则清空目录
if not os.path.exists('labels/%s' % (image_dir)):
    os.makedirs('labels/%s' % (image_dir))
else:
    shutil.rmtree('labels/%s' % (image_dir))
    os.makedirs('labels/%s' % (image_dir))
image_ids = GetFileList('Annotations/' + image_dir, ['xml'])
for image_id in image_ids:
    print(image_id)
    convert_annotation(image_dir, image_id)
</code></pre><p>转换自己的数据<br>我使用的labelImg工具做的图像标注，标记格式大体和VOC一致。<br>工具地址见GitHub： <a href=https://github.com/tzutalin/labelImg target=_blank>https://github.com/tzutalin/labelImg</a><p>只需要简单修改voc_label.py就可以转换自己的数据。修改后的脚本命名为lableImg_voc_to_yolo.py。我放在了GitHub上：<p><a href=https://github.com/PaulChongPeng/darknet/blob/master/tools/lableImg_voc_to_yolo.py target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/tools/lableImg_voc_to_yolo.py</a><h1 id=coding-utf-8-2>coding=utf-8</h1><h1 id=使用说明-2>使用说明</h1><h1 id=要转换的数据集目录结构为>要转换的数据集目录结构为：</h1><h1 id=paul-time-class-annotations-xml文件>Paul/time/class/annotations/xml文件</h1><h1 id=paul-time-class-images-jpg文件>Paul/time/class/images/jpg文件</h1><h1 id=paul-time-class-labels-即将生成的yolo需要的txt文件>Paul/time/class/labels/即将生成的yolo需要的txt文件</h1><h1 id=该文件需放在paul目录下-该目录下将会生成名为-日期-的txt文件-文件内容为日期文件夹下所有图片的路径>该文件需放在Paul目录下，该目录下将会生成名为“日期”的txt文件，文件内容为日期文件夹下所有图片的路径</h1><h1 id=有多少个日期的文件夹-就将多少个文件夹的名字加入sets>有多少个日期的文件夹，就将多少个文件夹的名字加入sets</h1><h1 id=需要生成多少种物体的标签-就将多少种物体加入classes>需要生成多少种物体的标签，就将多少种物体加入classes</h1><h1 id=labels目录下生成的txt文件中的第一个数字就是物体种类在classes中的索引>labels目录下生成的txt文件中的第一个数字就是物体种类在classes中的索引</h1><p>import xml.etree.ElementTree as ET<br>import pickle<br>import os<br>from os import listdir, getcwd<br>from os.path import join<br>import shutil<p>sets = ['20170401', '20170414']<h1 id=获取所需要的类名和id-2>获取所需要的类名和id</h1><h1 id=path为类名和id的对应关系列表的地址-标注文件中可能有很多类-我们只加载该path指向文件中的类-2>path为类名和id的对应关系列表的地址（标注文件中可能有很多类，我们只加载该path指向文件中的类）</h1><h1 id=返回值是一个字典-键名是类名-键值是id-2>返回值是一个字典，键名是类名，键值是id</h1><p>def get_classes_and_index(path):<pre><code>D = {}
f = open(path)
for line in f:
    temp = line.rstrip().split(',', 2)
    print(&quot;temp[0]:&quot; + temp[0] + &quot;\n&quot;)
    print(&quot;temp[1]:&quot; + temp[1] + &quot;\n&quot;)
    D[temp[1].replace(' ', '')] = temp[0]
return D
</code></pre><h1 id=将roi的坐标转换为yolo需要的坐标-2>将ROI的坐标转换为yolo需要的坐标</h1><h1 id=size是图片的w和h-2>size是图片的w和h</h1><h1 id=box里保存的是roi的坐标-x-y的最大值和最小值-2>box里保存的是ROI的坐标（x，y的最大值和最小值）</h1><h1 id=返回值为roi中心点相对于图片大小的比例坐标-和roi的w-h相对于图片大小的比例-2>返回值为ROI中心点相对于图片大小的比例坐标，和ROI的w、h相对于图片大小的比例</h1><p>def convert(size, box):<pre><code>dw = 1. / size[0]
dh = 1. / size[1]
x = (box[0] + box[1]) / 2.0
y = (box[2] + box[3]) / 2.0
w = box[1] - box[0]
h = box[3] - box[2]
x = x * dw
w = w * dw
y = y * dh
h = h * dh
return (x, y, w, h)
</code></pre><h1 id=将labelimg-生成的xml文件转换为yolo需要的txt文件-1>将labelImg 生成的xml文件转换为yolo需要的txt文件</h1><h1 id=path到类名一级的目录路径>path到类名一级的目录路径</h1><h1 id=image-id图片名-1>image_id图片名</h1><p>def convert_annotation(path, image_id):<pre><code>in_file = open('%s/annotations/%s.xml' % (path, image_id))
out_file = open('%s/labels/%s.txt' % (path, image_id), 'w')
tree = ET.parse(in_file)
root = tree.getroot()
size = root.find('size')
w = int(size.find('width').text)
h = int(size.find('height').text)

for obj in root.iter('object'):
    cls = obj.find('name').text.replace(' ', '')
    # 如果该类物体不在我们的yolo训练列表中，跳过
    if cls not in classes:
        continue
    cls_id = classes[cls]  # 获取该类物体在yolo训练列表中的id
    xmlbox = obj.find('bndbox')
    b = (float(xmlbox.find('xmin').text), float(xmlbox.find('xmax').text), float(xmlbox.find('ymin').text),
         float(xmlbox.find('ymax').text))
    bb = convert((w, h), b)
    out_file.write(str(cls_id) + &quot; &quot; + &quot; &quot;.join([str(a) for a in bb]) + '\n')
</code></pre><p>def IsSubString(SubStrList, Str):<pre><code>flag = True
for substr in SubStrList:
    if not (substr in Str):
        flag = False

return flag
</code></pre><h1 id=获取findpath路径下指定格式-flagstr-的文件名-不包含后缀名-列表-1>获取FindPath路径下指定格式（FlagStr）的文件名（不包含后缀名）列表</h1><p>def GetFileList(FindPath, FlagStr=[]):<pre><code>import os
FileList = []
FileNames = os.listdir(FindPath)
if (len(FileNames) &gt; 0):
    for fn in FileNames:
        if (len(FlagStr) &gt; 0):
            if (IsSubString(FlagStr, fn)):
                FileList.append(fn[:-4])
        else:
            FileList.append(fn)

if (len(FileList) &gt; 0):
    FileList.sort()

return FileList
</code></pre><h1 id=获取目录下子目录的目录名列表>获取目录下子目录的目录名列表</h1><p>def get_dirs(time):<pre><code>dirs = []
dirs_temp = os.listdir(time)
for dir_name in dirs_temp:
    dirs.append(time + '/' + dir_name)
return dirs
</code></pre><p>wd = getcwd()<p>classes = get_classes_and_index('/raid/pengchong_data/Tools/Paul_YOLO/data/Paul_list.txt')<p>for time in sets:<pre><code>dirs = get_dirs(time)
list_file = open('%s.txt' % time, 'w')  # 数据集的图片list保存路径
for path in dirs:
    print(path)
    if not os.path.exists('%s/annotations/' % path):
        os.makedirs('%s/annotations/' % path)
    if not os.path.exists('%s/labels/' % path):
        os.makedirs('%s/labels/' % path)
    else:
        shutil.rmtree('%s/labels/' % path)
        os.makedirs('%s/labels/' % path)
    image_ids = GetFileList(path + '/annotations/', ['xml'])
    for image_id in image_ids:
        print(image_id)
        list_file.write('%s/%s/images/%s.jpg\n' % (wd, path, image_id))
        convert_annotation(path, image_id)
list_file.close()
</code></pre><p>将各个数据集的标注文件转换成YOLO需要的格式后，将脚本生成的图像地址list的内容全部拷贝到paul.txt中，然后使用partial.py脚本随机分割为train,val,test data。脚本已上传至GitHut，可根据自己的需要进行修改。<p><a href=https://github.com/PaulChongPeng/darknet/blob/master/tools/partial.py target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/tools/partial.py</a><p>数据准备工作到此就算结束了。<p>准备配置文件<br>在cfg目录下添加paul.data,内容如下：<p>classes=10 要识别物体的种类数<br>train = data/paul_train.txt 训练集图片list<br>valid = data/paul_val.txt 验证集图片list<br>names = data/paul.names 要识别的物体list<br>backup = /mnt/large4t/pengchong_data/Tools/darknet/backup/ 训练时权重文件备份路径<p>在cfg目录下添加yolo-paul.cfg文件，该文件内容复制自默认的yolo-voc.cfg，根据自己的训练集和机器配置做修改，具体参数意义可以参考我之前的文章：<p>我修改的内容如下：<p>[net]<br>batch=27 每27张图更新一次权重，subdivisions=1时占用GPU memory 15.6G左右<br>......<br>......<br>learning_rate=0.00001 学习率大了容易发散<br>max_batches = 500000<br>......<br>......<br>[convolutional]<br>......<br>......<br>filters=75 最后一个卷积层输出的特征图数为5*(10+5)<br>......<br>......<br>[region]<br>......<br>......<br>classes=10 训练十种物体<br>......<br>......<p>在data目录下增加paul.names，内容如下：<p>ambulance<br>apple<br>automat<br>backpack<br>baggage<br>banana<br>baseball<br>basketball<br>bed<br>bench<p>修改Makefile<p>GPU=1<br>CUDNN=1<p>编译<p>make clean<br>make -j8<p>训练<br>首先准备ImageNet的预训练权重文件<p>curl -O <a href=https://pjreddie.com/media/files/darknet19.weights target=_blank>https://pjreddie.com/media/files/darknet19.weights</a><br>使用前23层的权重<p>./darknet partial cfg/darknet19_448.cfg darknet19_448.weights darknet19_448.conv.23 23<br>partial命令可以分割权重文件，fine-tune的时候也会用到。<p>开始训练<p>./darknet detector train cfg/paul.data cfg/yolo-paul.cfg darknet19_448.conv.23 2&gt;1 | tee paul_train_log.txt<br>剩下的就是等待了。<br>需要注意的是，如果学习率设置的比较大，训练结果很容易发散，训练过程输出的log会有nan字样，需要减小学习率后再进行训练。<p>多GPU训练技巧<br>darknet支持多GPU，使用多GPU训练可以极大加速训练速度。据我测试在DGX-1上使用8块Tesla P100同时训练的速度是在外星人上使用1块GTX1080的130多倍。<p>单GPU与多GPU的切换技巧<br>在darknet上使用多GPU训练需要一定技巧，盲目使用多GPU训练会悲剧的发现损失一直在下降、recall在上升，然而Obj几乎为零,最终得到的权重文件无法预测出bounding box。<p>使用多GPU训练前需要先用单GPU训练至Obj有稳定上升的趋势后（我一般在obj大于0.1后切换）再使用backup中备份的weights通过多GPU继续训练。一般情况下使用单GPU训练1000个迭代即可切换到多GPU。<p>./darknet detector train cfg/paul.data cfg/yolo-paul.cfg backup/yolo-paul_1000.weights -gpus 0,1,2,3,4,5,6,7 2&gt;1 | tee paul_train_log.txt<br>0,1,2,3,4,5,6,7是指定的GPU的ID，通过<p>nvidia-smi<br>命令可以查询:<p>+-----------------------------------------------------------------------------+<br>| NVIDIA-SMI 375.20 Driver Version: 375.20 |<br>|-------------------------------+----------------------+----------------------+<br>| GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC |<br>| Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. |<br>|===============================+======================+======================|<br>| 0 Tesla P100-SXM2... On | 0000:06:00.0 Off | 0 |<br>| N/A 52C P0 270W / 300W | 15887MiB / 16308MiB | 99% Default |<br>+-------------------------------+----------------------+----------------------+<br>| 1 Tesla P100-SXM2... On | 0000:07:00.0 Off | 0 |<br>| N/A 55C P0 247W / 300W | 15887MiB / 16308MiB | 97% Default |<br>+-------------------------------+----------------------+----------------------+<br>| 2 Tesla P100-SXM2... On | 0000:0A:00.0 Off | 0 |<br>| N/A 54C P0 252W / 300W | 15887MiB / 16308MiB | 98% Default |<br>+-------------------------------+----------------------+----------------------+<br>| 3 Tesla P100-SXM2... On | 0000:0B:00.0 Off | 0 |<br>| N/A 51C P0 242W / 300W | 15887MiB / 16308MiB | 97% Default |<br>+-------------------------------+----------------------+----------------------+<br>| 4 Tesla P100-SXM2... On | 0000:85:00.0 Off | 0 |<br>| N/A 53C P0 227W / 300W | 15887MiB / 16308MiB | 98% Default |<br>+-------------------------------+----------------------+----------------------+<br>| 5 Tesla P100-SXM2... On | 0000:86:00.0 Off | 0 |<br>| N/A 58C P0 245W / 300W | 15887MiB / 16308MiB | 97% Default |<br>+-------------------------------+----------------------+----------------------+<br>| 6 Tesla P100-SXM2... On | 0000:89:00.0 Off | 0 |<br>| N/A 59C P0 245W / 300W | 15887MiB / 16308MiB | 97% Default |<br>+-------------------------------+----------------------+----------------------+<br>| 7 Tesla P100-SXM2... On | 0000:8A:00.0 Off | 0 |<br>| N/A 52C P0 228W / 300W | 15887MiB / 16308MiB | 97% Default |<br>+-------------------------------+----------------------+----------------------+<br>+-----------------------------------------------------------------------------+<br>| Processes: GPU Memory |<br>| GPU PID Type Process name Usage |<br>|=============================================================================|<br>| 0 50064 C ./darknet 15887MiB |<br>| 1 50064 C ./darknet 15887MiB |<br>| 2 50064 C ./darknet 15887MiB |<br>| 3 50064 C ./darknet 15887MiB |<br>| 4 50064 C ./darknet 15887MiB |<br>| 5 50064 C ./darknet 15887MiB |<br>| 6 50064 C ./darknet 15887MiB |<br>| 7 50064 C ./darknet 15887MiB |<br>+-----------------------------------------------------------------------------+<br>使用多GPU时的学习率<br>使用多GPU训练时，学习率是使用单GPU训练的n倍，n是使用GPU的个数<p>可视化训练过程的中间参数<br>等待训练结束后（有时候没等结束我们的模型就开始发散了），我们需要检查各项指标（如loss）是否达到了我们期望的数值，如果没有，要分析为什么。可视化训练过程的中间参数可以帮助我们分析问题。<p>可视化中间参数需要用到训练时保存的log文件paul_train_log.txt<p>训练log中各参数的意义<br>Region Avg IOU：平均的IOU，代表预测的bounding box和ground truth的交集与并集之比，期望该值趋近于1。<p>Class:是标注物体的概率，期望该值趋近于1.<p>Obj：期望该值趋近于1.<p>No Obj:期望该值越来越小但不为零.<p>Avg Recall：期望该值趋近1<p>avg：平均损失，期望该值趋近于0<p>使用train_loss_visualization.py脚本可以绘制loss变化曲线。<br>脚本已上传至GitHub（使用前需安装依赖）：<br><a href=https://github.com/PaulChongPeng/darknet/blob/master/tools/train_loss_visualization.py target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/tools/train_loss_visualization.py</a><p>import pandas as pd<br>import numpy as np<br>import matplotlib.pyplot as plt<p>lines =1878760<br>result = pd.read_csv('S:/Tools/Paul_YOLO/paul_train_log_new.txt', skiprows=[x for x in range(lines) if ((x%10!=9) |(x&lt;1000))] ,error_bad_lines=False, names=['loss', 'avg', 'rate', 'seconds', 'images'])<br>result.head()<p>result['loss']=result['loss'].str.split(' ').str.get(1)<br>result['avg']=result['avg'].str.split(' ').str.get(1)<br>result['rate']=result['rate'].str.split(' ').str.get(1)<br>result['seconds']=result['seconds'].str.split(' ').str.get(1)<br>result['images']=result['images'].str.split(' ').str.get(1)<br>result.head()<br>result.tail()<p>#print(result.head())<h1 id=print-result-tail>print(result.tail())</h1><h1 id=print-result-dtypes>print(result.dtypes)</h1><p>print(result['loss'])<br>print(result['avg'])<br>print(result['rate'])<br>print(result['seconds'])<br>print(result['images'])<p>result['loss']=pd.to_numeric(result['loss'])<br>result['avg']=pd.to_numeric(result['avg'])<br>result['rate']=pd.to_numeric(result['rate'])<br>result['seconds']=pd.to_numeric(result['seconds'])<br>result['images']=pd.to_numeric(result['images'])<br>result.dtypes<p>fig = plt.figure()<br>ax = fig.add_subplot(1, 1, 1)<br>ax.plot(result['avg'].values,label='avg_loss')<br>#ax.plot(result['loss'].values,label='loss')<br>ax.legend(loc='best')<br>ax.set_title('The loss curves')<br>ax.set_xlabel('batches')<br>fig.savefig('avg_loss')<br>#fig.savefig('loss')<p>脚本使用说明：<p>使用命令<p>2&gt;1 | tee paul_train_log.txt<br>保存log时会生成两个文件，文件1里保存的是网络加载信息和checkout点保存信息，paul_train_log.txt中保存的是训练信息。<p>1、删除log开头的三行：<p>0,1,2,3,4,5,6,7<br>yolo-paul<br>Learning Rate: 1e-05, Momentum: 0.9, Decay: 0.0005<br>2、删除log的结尾几行，使最后一行为batch的输出，如：<pre><code>497001: 0.863348, 0.863348 avg, 0.001200 rate, 5.422251 seconds, 107352216 images
</code></pre><p>3、执行extract_log.py脚本，格式化log。脚本代码见GitHub：<br><a href=https://github.com/PaulChongPeng/darknet/blob/master/tools/extract_log.py target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/tools/extract_log.py</a><h1 id=coding-utf-8-3>coding=utf-8</h1><h1 id=该文件用来提取训练log-去除不可解析的log后使log文件格式化-生成新的log文件供可视化工具绘图>该文件用来提取训练log，去除不可解析的log后使log文件格式化，生成新的log文件供可视化工具绘图</h1><p>import random<p>f = open('paul_train_log.txt')<br>train_log = open('paul_train_log_new.txt', 'w')<p>for line in f:<pre><code># 去除多gpu的同步log
if 'Syncing' in line:
    continue
# 去除除零错误的log
if 'nan' in line:
    continue
train_log.write(line)
</code></pre><p>f.close()<br>train_log.close()<p>最终log格式：<p>Loaded: 5.588888 seconds<br>Region Avg IOU: 0.649881, Class: 0.854394, Obj: 0.476559, No Obj: 0.007302, Avg Recall: 0.737705, count: 61<br>Region Avg IOU: 0.671544, Class: 0.959081, Obj: 0.523326, No Obj: 0.006902, Avg Recall: 0.780000, count: 50<br>Region Avg IOU: 0.525841, Class: 0.815314, Obj: 0.449031, No Obj: 0.006602, Avg Recall: 0.484375, count: 64<br>Region Avg IOU: 0.583596, Class: 0.830763, Obj: 0.377681, No Obj: 0.007916, Avg Recall: 0.629214, count: 89<br>Region Avg IOU: 0.651377, Class: 0.908635, Obj: 0.460094, No Obj: 0.008060, Avg Recall: 0.753425, count: 73<br>Region Avg IOU: 0.571363, Class: 0.880554, Obj: 0.341659, No Obj: 0.007820, Avg Recall: 0.633663, count: 101<br>Region Avg IOU: 0.585424, Class: 0.935552, Obj: 0.358635, No Obj: 0.008192, Avg Recall: 0.644860, count: 107<br>Region Avg IOU: 0.599972, Class: 0.832793, Obj: 0.382910, No Obj: 0.009005, Avg Recall: 0.650602, count: 83<br>497001: 0.863348, 0.863348 avg, 0.000012 rate, 5.422251 seconds, 107352216 images<p>4、修改train_loss_visualization.py中lines为log行数，并根据需要修改要跳过的行数。<p>skiprows=[x for x in range(lines) if ((x%10!=9) |(x&lt;1000))]<br>运行train_loss_visualization.py会在脚本所在路径生成avg_loss.png。<p>这里写图片描述<p>从损失变化曲线可以看出，模型在100000万次迭代后损失下降速度非常慢，几乎没有下降。结合log和cfg文件发现，我自定义的学习率变化策略在十万次迭代时会减小十倍，十万次迭代后学习率下降到非常小的程度，导致损失下降速度降低。修改cfg中的学习率变化策略，10万次迭代时不改变学习率，30万次时再降低。<p>我使用迭代97000次时的备份的checkout点来继续训练。<p>./darknet detector train cfg/paul.data cfg/yolo-paul.cfg backup/yolo-paul_97000.weights 2&gt;1 | tee paul_train_log.txt<br>除了可视化loss，还可以可视化Avg IOU，Avg Recall等参数。<br>可视化’Region Avg IOU’, ‘Class’, ‘Obj’, ‘No Obj’, ‘Avg Recall’,’count’这些参数可以使用脚本train_iou_visualization.py，使用方式和train_loss_visualization.py相同。脚本已上传至GitHub：<a href=https://github.com/PaulChongPeng/darknet/blob/master/tools/train_iou_visualization.py target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/tools/train_iou_visualization.py</a><p>import pandas as pd<br>import numpy as np<br>import matplotlib.pyplot as plt<p>lines =525990<br>result = pd.read_csv('S:/Tools/Paul_YOLO/paul_train_log_new.txt', skiprows=[x for x in range(lines) if (x%10==0 or x%10==9) ] ,error_bad_lines=False, names=['Region Avg IOU', 'Class', 'Obj', 'No Obj', 'Avg Recall','count'])<br>result.head()<p>result['Region Avg IOU']=result['Region Avg IOU'].str.split(': ').str.get(1)<br>result['Class']=result['Class'].str.split(': ').str.get(1)<br>result['Obj']=result['Obj'].str.split(': ').str.get(1)<br>result['No Obj']=result['No Obj'].str.split(': ').str.get(1)<br>result['Avg Recall']=result['Avg Recall'].str.split(': ').str.get(1)<br>result['count']=result['count'].str.split(': ').str.get(1)<br>result.head()<br>result.tail()<p>#print(result.head())<h1 id=print-result-tail-1>print(result.tail())</h1><h1 id=print-result-dtypes-1>print(result.dtypes)</h1><p>print(result['Region Avg IOU'])<p>result['Region Avg IOU']=pd.to_numeric(result['Region Avg IOU'])<br>result['Class']=pd.to_numeric(result['Class'])<br>result['Obj']=pd.to_numeric(result['Obj'])<br>result['No Obj']=pd.to_numeric(result['No Obj'])<br>result['Avg Recall']=pd.to_numeric(result['Avg Recall'])<br>result['count']=pd.to_numeric(result['count'])<br>result.dtypes<p>fig = plt.figure()<br>ax = fig.add_subplot(1, 1, 1)<br>#ax.plot(result['Region Avg IOU'].values,label='Region Avg IOU')<br>#ax.plot(result['Class'].values,label='Class')<br>#ax.plot(result['Obj'].values,label='Obj')<br>#ax.plot(result['No Obj'].values,label='No Obj')<br>ax.plot(result['Avg Recall'].values,label='Avg Recall')<br>#ax.plot(result['count'].values,label='count')<br>ax.legend(loc='best')<br>#ax.set_title('The Region Avg IOU curves')<br>ax.set_title('The Avg Recall curves')<br>ax.set_xlabel('batches')<br>#fig.savefig('Avg IOU')<br>fig.savefig('Avg Recall')<p>这里写图片描述<p>使用验证集评估模型<br>评估模型可以使用命令valid（只有预测结果，没有评价预测是否正确）或recall，这两个命令都无法满足我的需求，我实现了category命令做性能评估。<p>valid:<br>在paul.data末尾添加<p>eval = imagenet #有voc、coco、imagenet三种模式<br>修改Detector.c文件validate_detector函数，修改阈值（默认.005）<p>float thresh = .1;<br>重新编译然后执行命令<p>./darknet detector valid cfg/paul.data cfg/yolo-paul.cfg backup/yolo-paul_final.weights<br>results目录下会生成预测结果，格式如下：<p>1 1 0.431522 235.186066 77.746033 421.808258 348.950012<br>1 1 0.186538 161.324097 270.221497 187.429535 321.382141<br>1 14 0.166257 284.207947 364.423889 465.995056 454.305603<br>2 30 0.287718 274.455719 290.674194 343.506256 352.656433<br>2 30 0.582356 293.578918 294.799438 350.478088 327.216614<br>2 1 0.599921 138.686981 314.705231 352.362152 588.235962<br>3 59 0.251553 193.290497 183.707275 277.655273 349.782410<br>3 59 0.107120 209.172287 269.722626 330.998718 342.530914<br>3 62 0.162954 0.000000 278.525543 457.739563 480.000000<br>4 6 0.617184 38.155792 31.496445 434.091705 527.705811<br>4 1 0.101005 358.778351 238.540756 395.645050 289.902283<br>4 6 0.813770 75.790985 282.521210 459.018585 564.883545<br>4 3 0.114561 32.667072 407.288025 142.561798 506.885498<br>4 3 0.104120 87.489151 337.674896 446.883728 584.356689<br>5 1 0.106601 235.460571 0.707840 265.958740 34.851868<br>5 1 0.134753 310.776398 1.273307 344.392303 31.028347<br>5 1 0.146177 349.860596 0.445604 385.901550 29.931465<br>5 1 0.129790 388.831177 3.721551 419.852844 30.414955<br>5 1 0.146747 369.672150 0.000000 441.490387 45.012733<br>5 1 0.339233 7.567236 0.000000 53.692001 97.718735<p>如果想要查看recall可以使用recall命令。<br>修改费Detector.c文件的validate_detector_recall函数：<p>1、修改阈值：<p>float thresh = .25;<br>2、修改验证集路径：<p>list *plist = get_paths(&quot;/mnt/large4t/pengchong_data/Data/Paul/filelist/val.txt&quot;);<br>3、增加Precision<p>//fprintf(stderr, &quot;%5d %5d %5d\tRPs/Img: %.2f\tIOU: %.2f%%\tRecall:%.2f%%\n&quot;, i, correct, total, (float)proposals/(i+1), avg_iou*100/total, 100.*correct/total);<br>fprintf(stderr, &quot;ID:%5d Correct:%5d Total:%5d\tRPs/Img: %.2f\tIOU: %.2f%%\tRecall:%.2f%%\t&quot;, i, correct, total, (float)proposals/(i+1), avg_iou*100/total, 100.*correct/total);<br>fprintf(stderr, &quot;proposals:%5d\tPrecision:%.2f%%\n&quot;,proposals,100.*correct/(float)proposals);<br>重新编译然后执行命令<p>./darknet detector recall cfg/paul.data cfg/yolo-paul.cfg backup/yolo-paul_final.weights<br>结果格式如下：<p>ID: 0 Correct: 1 Total: 22 RPs/Img: 2.00 IOU: 7.59% Recall:4.55% proposals: 2 Precision:50.00%<br>ID: 1 Correct: 2 Total: 28 RPs/Img: 2.00 IOU: 8.90% Recall:7.14% proposals: 4 Precision:50.00%<br>ID: 2 Correct: 3 Total: 39 RPs/Img: 1.67 IOU: 7.91% Recall:7.69% proposals: 5 Precision:60.00%<br>ID: 3 Correct: 3 Total: 42 RPs/Img: 2.00 IOU: 7.42% Recall:7.14% proposals: 8 Precision:37.50%<br>ID: 4 Correct: 9 Total: 58 RPs/Img: 5.00 IOU: 15.96% Recall:15.52% proposals: 25 Precision:36.00%<br>ID: 5 Correct: 10 Total: 70 RPs/Img: 4.50 IOU: 14.99% Recall:14.29% proposals: 27 Precision:37.04%<br>ID: 6 Correct: 12 Total: 72 RPs/Img: 4.00 IOU: 16.51% Recall:16.67% proposals: 28 Precision:42.86%<br>ID: 7 Correct: 14 Total: 76 RPs/Img: 3.75 IOU: 17.60% Recall:18.42% proposals: 30 Precision:46.67%<br>ID: 8 Correct: 16 Total: 81 RPs/Img: 3.78 IOU: 19.15% Recall:19.75% proposals: 34 Precision:47.06%<br>ID: 9 Correct: 20 Total: 96 RPs/Img: 3.80 IOU: 20.40% Recall:20.83% proposals: 38 Precision:52.63%<br>ID: 10 Correct: 22 Total: 103 RPs/Img: 3.82 IOU: 21.09% Recall:21.36% proposals: 42 Precision:52.38%<p>category命令评估模型针对每种物体检测的性能<br>代码已提交至GitHub：<a href=https://github.com/PaulChongPeng/darknet/blob/master/src/detector.c target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/src/detector.c</a><p>void print_category(FILE **fps, char *path, box *boxes, float **probs, int total, int classes, int w, int h, float thresh, float iou_thresh)<br>{<pre><code>int i, j;

char labelpath[4096];
find_replace(path, &quot;images&quot;, &quot;labels&quot;, labelpath);
find_replace(labelpath, &quot;JPEGImages&quot;, &quot;labels&quot;, labelpath);
find_replace(labelpath, &quot;.jpg&quot;, &quot;.txt&quot;, labelpath);
find_replace(labelpath, &quot;.JPEG&quot;, &quot;.txt&quot;, labelpath);

int num_labels = 0;
box_label *truth = read_boxes(labelpath, &amp;num_labels);

for(i = 0; i &lt; total; ++i){
    int class_id = max_index(probs[i],classes);
    float prob = probs[i][class_id];
    if (prob &lt; thresh)continue;

    float best_iou = 0;
    int best_iou_id = 0;
    int correct = 0;
    for (j = 0; j &lt; num_labels; ++j) {
        box t = {truth[j].x*w, truth[j].y*h, truth[j].w*w, truth[j].h*h};
        float iou = box_iou(boxes[i], t);
        //fprintf(stderr, &quot;box p: %f, %f, %f, %f\n&quot;, boxes[i].x, boxes[i].y, boxes[i].w, boxes[i].h);
        //fprintf(stderr, &quot;box t: %f, %f, %f, %f\n&quot;, t.x, t.y, t.w, t.h);
        //fprintf(stderr, &quot;iou : %f\n&quot;, iou);
        if(iou &gt; best_iou){
            best_iou = iou;
            best_iou_id = j;
        }
    }

    if(best_iou &gt; iou_thresh &amp;&amp; truth[best_iou_id].id == class_id){
        correct = 1;
    }

    float xmin = boxes[i].x - boxes[i].w/2.;
    float xmax = boxes[i].x + boxes[i].w/2.;
    float ymin = boxes[i].y - boxes[i].h/2.;
    float ymax = boxes[i].y + boxes[i].h/2.;

    if (xmin &lt; 0) xmin = 0;
    if (ymin &lt; 0) ymin = 0;
    if (xmax &gt; w) xmax = w;
    if (ymax &gt; h) ymax = h;

    fprintf(fps[class_id], &quot;%s, %d, %d, %f, %f, %f, %f, %f, %f\n&quot;, path, class_id, correct, prob, best_iou, xmin, ymin, xmax, ymax);

}
</code></pre><p>}<p>void validate_detector_category(char *datacfg, char *cfgfile, char *weightfile, char *outfile)<br>{<pre><code>int j;
list *options = read_data_cfg(datacfg);
char *valid_images = option_find_str(options, &quot;valid&quot;, &quot;data/train.list&quot;);
char *name_list = option_find_str(options, &quot;names&quot;, &quot;data/names.list&quot;);
char *prefix = option_find_str(options, &quot;results&quot;, &quot;results&quot;);
char **names = get_labels(name_list);
char *mapf = option_find_str(options, &quot;map&quot;, 0);
int *map = 0;
if (mapf) map = read_map(mapf);

network net = parse_network_cfg(cfgfile);
if(weightfile){
    load_weights(&amp;net, weightfile);
}
set_batch_network(&amp;net, 1);
fprintf(stderr, &quot;Learning Rate: %g, Momentum: %g, Decay: %g\n&quot;, net.learning_rate, net.momentum, net.decay);
srand(time(0));

list *plist = get_paths(valid_images);
char **paths = (char **)list_to_array(plist);

layer l = net.layers[net.n-1];
int classes = l.classes;

char buff[1024];
FILE **fps = 0;
if(!outfile) outfile = &quot;paul_&quot;;
fps = calloc(classes, sizeof(FILE *));
for(j = 0; j &lt; classes; ++j){
    snprintf(buff, 1024, &quot;%s/%s%s.txt&quot;, prefix, outfile, names[j]);
    fps[j] = fopen(buff, &quot;w&quot;);
}


box *boxes = calloc(l.w*l.h*l.n, sizeof(box));
float **probs = calloc(l.w*l.h*l.n, sizeof(float *));
for(j = 0; j &lt; l.w*l.h*l.n; ++j) probs[j] = calloc(classes, sizeof(float *));

int m = plist-&gt;size;
int i=0;
int t;

float thresh = .25;
float iou_thresh = .5;
float nms = .45;

int nthreads = 4;
image *val = calloc(nthreads, sizeof(image));
image *val_resized = calloc(nthreads, sizeof(image));
image *buf = calloc(nthreads, sizeof(image));
image *buf_resized = calloc(nthreads, sizeof(image));
pthread_t *thr = calloc(nthreads, sizeof(pthread_t));

load_args args = {0};
args.w = net.w;
args.h = net.h;
args.type = IMAGE_DATA;

for(t = 0; t &lt; nthreads; ++t){
    args.path = paths[i+t];
    args.im = &amp;buf[t];
    args.resized = &amp;buf_resized[t];
    thr[t] = load_data_in_thread(args);
}
time_t start = time(0);
for(i = nthreads; i &lt; m+nthreads; i += nthreads){
    fprintf(stderr, &quot;%d\n&quot;, i);
    for(t = 0; t &lt; nthreads &amp;&amp; i+t-nthreads &lt; m; ++t){
        pthread_join(thr[t], 0);
        val[t] = buf[t];
        val_resized[t] = buf_resized[t];
    }
    for(t = 0; t &lt; nthreads &amp;&amp; i+t &lt; m; ++t){
        args.path = paths[i+t];
        args.im = &amp;buf[t];
        args.resized = &amp;buf_resized[t];
        thr[t] = load_data_in_thread(args);
    }
    for(t = 0; t &lt; nthreads &amp;&amp; i+t-nthreads &lt; m; ++t){
        char *path = paths[i+t-nthreads];
        float *X = val_resized[t].data;
        network_predict(net, X);
        int w = val[t].w;
        int h = val[t].h;
        get_region_boxes(l, w, h, thresh, probs, boxes, 0, map, .5);
        if (nms) do_nms_sort(boxes, probs, l.w*l.h*l.n, classes, nms);
        print_category(fps, path, boxes, probs, l.w*l.h*l.n, classes, w, h, thresh, iou_thresh);
        free_image(val[t]);
        free_image(val_resized[t]);
    }
}
for(j = 0; j &lt; classes; ++j){
    if(fps) fclose(fps[j]);
}
fprintf(stderr, &quot;Total Detection Time: %f Seconds\n&quot;, (double)(time(0) - start));
</code></pre><p>}<p>void run_detector(int argc, char **argv)<br>{<pre><code>char *prefix = find_char_arg(argc, argv, &quot;-prefix&quot;, 0);
float thresh = find_float_arg(argc, argv, &quot;-thresh&quot;, .24);
float hier_thresh = find_float_arg(argc, argv, &quot;-hier&quot;, .5);
int cam_index = find_int_arg(argc, argv, &quot;-c&quot;, 0);
int frame_skip = find_int_arg(argc, argv, &quot;-s&quot;, 0);
if(argc &lt; 4){
    fprintf(stderr, &quot;usage: %s %s [train/test/valid] [cfg] [weights (optional)]\n&quot;, argv[0], argv[1]);
    return;
}
char *gpu_list = find_char_arg(argc, argv, &quot;-gpus&quot;, 0);
char *outfile = find_char_arg(argc, argv, &quot;-out&quot;, 0);
int *gpus = 0;
int gpu = 0;
int ngpus = 0;
if(gpu_list){
    printf(&quot;%s\n&quot;, gpu_list);
    int len = strlen(gpu_list);
    ngpus = 1;
    int i;
    for(i = 0; i &lt; len; ++i){
        if (gpu_list[i] == ',') ++ngpus;
    }
    gpus = calloc(ngpus, sizeof(int));
    for(i = 0; i &lt; ngpus; ++i){
        gpus[i] = atoi(gpu_list);
        gpu_list = strchr(gpu_list, ',')+1;
    }
} else {
    gpu = gpu_index;
    gpus = &amp;gpu;
    ngpus = 1;
}

int clear = find_arg(argc, argv, &quot;-clear&quot;);

char *datacfg = argv[3];
char *cfg = argv[4];
char *weights = (argc &gt; 5) ? argv[5] : 0;
char *filename = (argc &gt; 6) ? argv[6]: 0;
if(0==strcmp(argv[2], &quot;test&quot;)) test_detector(datacfg, cfg, weights, filename, thresh, hier_thresh);
else if(0==strcmp(argv[2], &quot;train&quot;)) train_detector(datacfg, cfg, weights, gpus, ngpus, clear);
else if(0==strcmp(argv[2], &quot;valid&quot;)) validate_detector(datacfg, cfg, weights, outfile);
else if(0==strcmp(argv[2], &quot;recall&quot;)) validate_detector_recall(cfg, weights);
else if(0==strcmp(argv[2], &quot;category&quot;))validate_detector_category(datacfg, cfg, weights, outfile);
else if(0==strcmp(argv[2], &quot;demo&quot;)) {
    list *options = read_data_cfg(datacfg);
    int classes = option_find_int(options, &quot;classes&quot;, 20);
    char *name_list = option_find_str(options, &quot;names&quot;, &quot;data/names.list&quot;);
    char **names = get_labels(name_list);
    demo(cfg, weights, thresh, cam_index, filename, names, classes, frame_skip, prefix, hier_thresh);
}
</code></pre><p>}<p>执行命令<p>./darknet detector category cfg/paul.data cfg/yolo-paul.cfg backup/yolo-paul_final.weights<br>result目录下会生成各类物体的val结果，有多少种物体，就会生成多少个txt文件，每个txt文件中有path, class_id, correct, prob, best_iou, xmin, ymin, xmax, ymax信息。<p>使用evalute.py工具可以解析这些txt文件做一个总结性的评估。<br>工具已上传到GitHub：<a href=https://github.com/PaulChongPeng/darknet/blob/master/tools/evalute.py target=_blank>https://github.com/PaulChongPeng/darknet/blob/master/tools/evalute.py</a><h1 id=coding-utf-8-4>coding=utf-8</h1><h1 id=本工具和category命令结合使用>本工具和category命令结合使用</h1><h1 id=category是在detector-c中新增的命令-主要作用是生成每类物体的evalute结果>category是在detector.c中新增的命令，主要作用是生成每类物体的evalute结果</h1><h1 id=执行命令-darknet-detector-category-cfg-paul-data-cfg-yolo-paul-cfg-backup-yolo-paul-final-weights>执行命令 ./darknet detector category cfg/paul.data cfg/yolo-paul.cfg backup/yolo-paul_final.weights</h1><h1 id=result目录下会生成各类物体的val结果-将本工具放在result目录下执行-会print出各种物体的evalute结果-包括>result目录下会生成各类物体的val结果，将本工具放在result目录下执行，会print出各种物体的evalute结果，包括</h1><h1 id=id-avg-iou-avg-correct-iou-avg-precision-avg-recall-avg-score>id,avg_iou,avg_correct_iou,avg_precision,avg_recall,avg_score</h1><h1 id=result目录下会生成low-list和high-list-内容分别为精度和recall未达标和达标的物体种类>result目录下会生成low_list和high_list，内容分别为精度和recall未达标和达标的物体种类</h1><p>import os<br>from os import listdir, getcwd<br>from os.path import join<br>import shutil<h1 id=共有多少类物体>共有多少类物体</h1><p>class_num = 97<h1 id=每类物体的验证结果>每类物体的验证结果</h1><p>class CategoryValidation:<pre><code>id = 0  # Category id
path = &quot;&quot;  # path
total_num = 0  # 标注文件中该类bounding box的总数
proposals_num = 0  # validate结果中共预测了多少个该类的bounding box
correct_num = 0  # 预测正确的bounding box（与Ground-truth的IOU大于0.5且种类正确）的数量
iou_num = 0  # 所有大于0.5的IOU的数量
iou_sum = 0  # 所有大于0.5的IOU的IOU之和
correct_iou_sum = 0  # 预测正确的bounding box的IOU之和
score_sum = 0  # 所有正确预测的bounding box的概率之和
avg_iou = 0  # 无论预测的bounding box的object的种类是否正确，所有bounding box 与最吻合的Ground-truth求出IOU，对大于0.5的IOU求平均值：avg_iou = iou_sum/iou_num
avg_correct_iou = 0  # 对预测正确的bounding box的IOU求平均值：avg_correct_iou = correct_iou_sum/correct_num
avg_precision = 0  # avg_precision = correct_num/proposals_num
avg_recall = 0  # avg_recall = correct_num/total_num
avg_score = 0  # avg_score=score_sum/correct_num

def __init__(self, path, val_cat_num):
    self.path = path
    f = open(path)

    for line in f:
        temp = line.rstrip().replace(' ', '').split(',', 9)
        temp[1] = int(temp[1])
        self.id = temp[1]
        self.total_num = val_cat_num[self.id]
        if (self.total_num):
            break

    for line in f:
        # path, class_id, correct, prob, best_iou, xmin, ymin, xmax, ymax
        temp = line.rstrip().split(', ', 9)
        temp[1] = int(temp[1])
        temp[2] = int(temp[2])
        temp[3] = float(temp[3])
        temp[4] = float(temp[4])
        self.proposals_num = self.proposals_num + 1.00
        if (temp[2]):
            self.correct_num = self.correct_num + 1.00
            self.score_sum = self.score_sum + temp[3]
            self.correct_iou_sum = self.correct_iou_sum + temp[4]
        if (temp[4] &gt; 0.5):
            self.iou_num = self.iou_num + 1
            self.iou_sum = self.iou_sum + temp[4]

    self.avg_iou = self.iou_sum / self.iou_num
    self.avg_correct_iou = self.correct_iou_sum / self.correct_num
    self.avg_precision = self.correct_num / self.proposals_num
    self.avg_recall = self.correct_num / self.total_num
    self.avg_score = self.score_sum / self.correct_num

    f.close()

# 导出识别正确的图片列表
def get_correct_list(self):
    f = open(self.path)
    new_f_name = &quot;correct_list_&quot; + self.id + &quot;.txt&quot;
    new_f = open(new_f_name, 'w')
    for line in f:
        temp = line.rstrip().split(', ', 9)
        if (temp[2]):
            new_f.write(line)
    f.close()

# 导出识别错误的图片列表
def get_error_list(self):
    f = open(self.path)
    new_f_name = &quot;error_list_&quot; + self.id + &quot;.txt&quot;
    new_f = open(new_f_name, 'w')
    for line in f:
        temp = line.rstrip().split(', ', 9)
        if (temp[2] == 0):
            new_f.write(line)
    f.close()

def print_eva(self):
    print(&quot;id=%d, avg_iou=%f, avg_correct_iou=%f, avg_precision=%f, avg_recall=%f, avg_score=%f \n&quot; % (self.id,
                                                                                                       self.avg_iou,
                                                                                                       self.avg_correct_iou,
                                                                                                       self.avg_precision,
                                                                                                       self.avg_recall,
                                                                                                       self.avg_score))
</code></pre><p>def IsSubString(SubStrList, Str):<pre><code>flag = True
for substr in SubStrList:
    if not (substr in Str):
        flag = False

return flag
</code></pre><h1 id=获取findpath路径下指定格式-flagstr-的文件名列表>获取FindPath路径下指定格式（FlagStr）的文件名列表</h1><p>def GetFileList(FindPath, FlagStr=[]):<pre><code>import os
FileList = []
FileNames = os.listdir(FindPath)
if (len(FileNames) &gt; 0):
    for fn in FileNames:
        if (len(FlagStr) &gt; 0):
            if (IsSubString(FlagStr, fn)):
                FileList.append(fn)
        else:
            FileList.append(fn)

if (len(FileList) &gt; 0):
    FileList.sort()

return FileList
</code></pre><h1 id=获取所有物体种类的roi数目>获取所有物体种类的ROI数目</h1><h1 id=path是图片列表的地址>path是图片列表的地址</h1><h1 id=返回值是一个list-list的索引是物体种类在yolo中的id-值是该种物体的roi数量>返回值是一个list，list的索引是物体种类在yolo中的id，值是该种物体的ROI数量</h1><p>def get_val_cat_num(path):<pre><code>val_cat_num = []
for i in range(0, class_num):
    val_cat_num.append(0)

f = open(path)
for line in f:
    label_path = line.rstrip().replace('images', 'labels')
    label_path = label_path.replace('JPEGImages', 'labels')
    label_path = label_path.replace('.jpg', '.txt')
    label_path = label_path.replace('.JPEG', '.txt')
    label_list = open(label_path)
    for label in label_list:
        temp = label.rstrip().split(&quot; &quot;, 4)
        id = int(temp[0])
        val_cat_num[id] = val_cat_num[id] + 1.00
    label_list.close()
f.close()
return val_cat_num
</code></pre><h1 id=获取物体名list>获取物体名list</h1><h1 id=path是物体名list文件地址>path是物体名list文件地址</h1><h1 id=返回值是一个列表-列表的索引是类的id-值为该类物体的名字>返回值是一个列表，列表的索引是类的id，值为该类物体的名字</h1><p>def get_name_list(path):<pre><code>name_list = []
f = open(path)
for line in f:
    temp = line.rstrip().split(',', 2)
    name_list.append(temp[1])
return name_list
</code></pre><p>wd = getcwd()<br>val_result_list = GetFileList(wd, ['txt'])<br>val_cat_num = get_val_cat_num(&quot;/raid/pengchong_data/Data/filelists/val.txt&quot;)<br>name_list = get_name_list(&quot;/raid/pengchong_data/Tools/Paul_YOLO/data/paul_list.txt&quot;)<br>low_list = open(&quot;low_list.log&quot;, 'w')<br>high_list = open(&quot;high_list.log&quot;, 'w')<br>for result in val_result_list:<pre><code>cat = CategoryValidation(result, val_cat_num)
cat.print_eva()
if ((cat.avg_precision &lt; 0.3) | (cat.avg_recall &lt; 0.3)):
    low_list.write(&quot;id=%d, name=%s, avg_precision=%f, avg_recall=%f \n&quot; % (cat.id, name_list[cat.id], cat.avg_precision, cat.avg_recall))
if ((cat.avg_precision &gt; 0.6) &amp; (cat.avg_recall &gt; 0.6)):
    high_list.write(&quot;id=%d, name=%s, avg_precision=%f, avg_recall=%f \n&quot; % (cat.id, name_list[cat.id], cat.avg_precision, cat.avg_recall))
</code></pre><p>low_list.close()<br>high_list.close()<p>将本工具放在result目录下执行，会print出各种物体的evalute结果，包括<br>id,avg_iou,avg_correct_iou,avg_precision,avg_recall,avg_score。<p>id=1, avg_iou=0.807394, avg_correct_iou=0.810435, avg_precision=0.473983, avg_recall=0.283531, avg_score=0.661014<p>id=2, avg_iou=0.824890, avg_correct_iou=0.826227, avg_precision=0.812950, avg_recall=0.824818, avg_score=0.772828<p>id=3, avg_iou=0.748561, avg_correct_iou=0.756006, avg_precision=0.401891, avg_recall=0.146048, avg_score=0.568196<p>id=4, avg_iou=0.821225, avg_correct_iou=0.822419, avg_precision=0.779621, avg_recall=0.798544, avg_score=0.773700<p>id=5, avg_iou=0.722905, avg_correct_iou=0.721078, avg_precision=0.391119, avg_recall=0.255361, avg_score=0.552248<p>id=6, avg_iou=0.814797, avg_correct_iou=0.814427, avg_precision=0.731707, avg_recall=0.612245, avg_score=0.833531<p>id=7, avg_iou=0.713375, avg_correct_iou=0.702796, avg_precision=0.739336, avg_recall=0.715596, avg_score=0.691065<p>id=8, avg_iou=0.785120, avg_correct_iou=0.797686, avg_precision=0.582267, avg_recall=0.594216, avg_score=0.734099<p>id=9, avg_iou=0.744355, avg_correct_iou=0.752729, avg_precision=0.523982, avg_recall=0.241049, avg_score=0.650683<p>id=10, avg_iou=0.736755, avg_correct_iou=0.744951, avg_precision=0.621368, avg_recall=0.382028, avg_score=0.651450<p>同时result目录下会生成low_list和high_list，内容分别为精度和recall未达标和达标的物体种类。</div><div class=clear></div></div></div></article><div class=clear></div><p class=post-tags><span class="fa fa-tags">Tags:</span>
<a rel=tag href=../../../tags/yolo>yolo</a><div id=related-posts><div class=related-inner></div></div><section id=comments class=themeform></section><section id=comments class=themeform></section></div></div><div class="sidebar s1 collapsed" data-position=left data-layout=col-3cm data-sb-id=s1><a class=sidebar-toggle title="Expand Sidebar"><i class="fas icon-sidebar-toggle"></i></a><div class=sidebar-content><div class="sidebar-top group"><p>Follow:<ul class=social-links><li><a class=social-tooltip href=mailto: title=Email><i class="fa fa-envelope"></i></a><li><a class=social-tooltip href=//github.com/ title=GitHub><i class="fa fa-github"></i></a><li><a class=social-tooltip title="RSS Feed" aria-label="RSS Feed" href=../../../feed target=_blank style=color:#ffffffb2><i class="fa fa-rss"></i></a></ul></div><ul class="post-nav group"><li class=previous><a href=../../../hardware/kernel/linux-platform-module_platform_driver/ rel=prev><i class="fa fa-chevron-left"></i><strong>Previous Post</strong>
<span>Linux驱动：module_platform_driver</span></a></ul><div id=categories-2 class="widget widget_categories"><h3>分类</h3><ul><li class="cat-item cat-item-1"><a href=../../../categories/ai/>Ai</a>
<small>(7)</small><li class="cat-item cat-item-1"><a href=../../../categories/algorithm/>Algorithm</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/android/>Android</a>
<small>(17)</small><li class="cat-item cat-item-1"><a href=../../../categories/ansible/>Ansible</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/beats/>Beats</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/busybox/>Busybox</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/caffe/>Caffe</a>
<small>(21)</small><li class="cat-item cat-item-1"><a href=../../../categories/cgo/>Cgo</a>
<small>(10)</small><li class="cat-item cat-item-1"><a href=../../../categories/clang/>Clang</a>
<small>(42)</small><li class="cat-item cat-item-1"><a href=../../../categories/cmd/>Cmd</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/cpp/>Cpp</a>
<small>(7)</small><li class="cat-item cat-item-1"><a href=../../../categories/cross_compile/>Cross_compile</a>
<small>(9)</small><li class="cat-item cat-item-1"><a href=../../../categories/css/>Css</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/dart/>Dart</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/database/>Database</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/dataset/>Dataset</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/deeplearning/>Deeplearning</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/devops/>Devops</a>
<small>(70)</small><li class="cat-item cat-item-1"><a href=../../../categories/docker/>Docker</a>
<small>(18)</small><li class="cat-item cat-item-1"><a href=../../../categories/dts/>Dts</a>
<small>(5)</small><li class="cat-item cat-item-1"><a href=../../../categories/elasticsearch/>Elasticsearch</a>
<small>(9)</small><li class="cat-item cat-item-1"><a href=../../../categories/english/>English</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/freertos/>Freertos</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/front-end/>Front-End</a>
<small>(20)</small><li class="cat-item cat-item-1"><a href=../../../categories/golang/>Golang</a>
<small>(136)</small><li class="cat-item cat-item-1"><a href=../../../categories/hacker/>Hacker</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/hardware/>Hardware</a>
<small>(22)</small><li class="cat-item cat-item-1"><a href=../../../categories/hi3519a/>Hi3519a</a>
<small>(4)</small><li class="cat-item cat-item-1"><a href=../../../categories/hi3559/>Hi3559</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/hisi/>Hisi</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/hisilicon/>Hisilicon</a>
<small>(57)</small><li class="cat-item cat-item-1"><a href=../../../categories/jetson/>Jetson</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/js/>Js</a>
<small>(9)</small><li class="cat-item cat-item-1"><a href=../../../categories/jumpserver/>Jumpserver</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/kernel/>Kernel</a>
<small>(16)</small><li class="cat-item cat-item-1"><a href=../../../categories/libev/>Libev</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/linux/>Linux</a>
<small>(94)</small><li class="cat-item cat-item-1"><a href=../../../categories/linux-system/>Linux-System</a>
<small>(8)</small><li class="cat-item cat-item-1"><a href=../../../categories/linux-%E5%91%BD%E4%BB%A4/>Linux-命令</a>
<small>(120)</small><li class="cat-item cat-item-1"><a href=../../../categories/mac/>Mac</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/machinelearn/>Machinelearn</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/machinelearning/>Machinelearning</a>
<small>(11)</small><li class="cat-item cat-item-1"><a href=../../../categories/macos/>Macos</a>
<small>(12)</small><li class="cat-item cat-item-1"><a href=../../../categories/math/>Math</a>
<small>(7)</small><li class="cat-item cat-item-1"><a href=../../../categories/matplotlib/>Matplotlib</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/mpp/>Mpp</a>
<small>(12)</small><li class="cat-item cat-item-1"><a href=../../../categories/mysql/>Mysql</a>
<small>(10)</small><li class="cat-item cat-item-1"><a href=../../../categories/ncnn/>Ncnn</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/network/>Network</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/nginx/>Nginx</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/nnie/>Nnie</a>
<small>(6)</small><li class="cat-item cat-item-1"><a href=../../../categories/node/>Node</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/numpy/>Numpy</a>
<small>(4)</small><li class="cat-item cat-item-1"><a href=../../../categories/opencpu/>Opencpu</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/opencv/>Opencv</a>
<small>(10)</small><li class="cat-item cat-item-1"><a href=../../../categories/pandas/>Pandas</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/platform/>Platform</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/post/>Post</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/pyqt/>Pyqt</a>
<small>(8)</small><li class="cat-item cat-item-1"><a href=../../../categories/python/>Python</a>
<small>(31)</small><li class="cat-item cat-item-1"><a href=../../../categories/pytorch/>Pytorch</a>
<small>(6)</small><li class="cat-item cat-item-1"><a href=../../../categories/raspi/>Raspi</a>
<small>(4)</small><li class="cat-item cat-item-1"><a href=../../../categories/rk3288/>Rk3288</a>
<small>(23)</small><li class="cat-item cat-item-1"><a href=../../../categories/rk3399/>Rk3399</a>
<small>(9)</small><li class="cat-item cat-item-1"><a href=../../../categories/rtmp/>Rtmp</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/scikit/>Scikit</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/shell/>Shell</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/socket/>Socket</a>
<small>(5)</small><li class="cat-item cat-item-1"><a href=../../../categories/stm32/>Stm32</a>
<small>(6)</small><li class="cat-item cat-item-1"><a href=../../../categories/stm8/>Stm8</a>
<small>(9)</small><li class="cat-item cat-item-1"><a href=../../../categories/wechat/>Wechat</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/weixin/>Weixin</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/windows/>Windows</a>
<small>(22)</small><li class="cat-item cat-item-1"><a href=../../../categories/work/>Work</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/yolo/>Yolo</a>
<small>(16)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/>前端技术</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E5%8D%8F%E8%AE%AE/>协议</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/>嵌入式</a>
<small>(23)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E5%B7%A5%E5%85%B7/>工具</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E5%B8%B8%E7%94%A8%E7%AE%97%E6%B3%95/>常用算法</a>
<small>(2)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/>微服务</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88/>排列组合</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E6%95%B0%E6%8D%AE%E5%BA%93/>数据库</a>
<small>(37)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E6%96%87%E6%9C%AC%E7%BC%96%E8%BE%91/>文本编辑</a>
<small>(30)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/>正则表达式</a>
<small>(3)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E7%94%9F%E6%B4%BB%E6%8A%80%E5%B7%A7/>生活技巧</a>
<small>(4)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E7%A8%8B%E5%BA%8F%E5%91%98/>程序员</a>
<small>(1)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/>网络安全</a>
<small>(40)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E9%9B%86%E7%BE%A4%E7%9B%91%E6%8E%A7/>集群监控</a>
<small>(7)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E9%9D%99%E6%80%81%E5%8D%9A%E5%AE%A2/>静态博客</a>
<small>(15)</small><li class="cat-item cat-item-1"><a href=../../../categories/%E9%AB%98%E6%95%B0/>高数</a>
<small>(2)</small></ul></div></div></div><div class="sidebar s2 collapsed" data-position=right data-layout=col-3cm data-sb-id=s2><a class=sidebar-toggle title="Expand Sidebar"><i class="fas icon-sidebar-toggle"></i></a><div class=sidebar-content><div class="sidebar-top group"><p>More</div><ul class="post-nav group"><li class=next><a href=../../../hardware/hisilicon/nnie/nnie-mapper/ rel=next><i class="fa fa-chevron-right"></i><strong>Next post</strong>
<span>nnie mapper</span></a></ul><div id=tag_cloud-2 class="widget widget_tag_cloud"><h3>标签云</h3><div class="tagcloud post-tags"><a rel=tag href=../../../tags/ai/ class=tag-link-7 title="1 Posts">ai<small>(7)</small></a>
<a rel=tag href=../../../tags/ansible/ class=tag-link-19 title="1 Posts">ansible<small>(19)</small></a>
<a rel=tag href=../../../tags/awesome/ class=tag-link-3 title="1 Posts">awesome<small>(3)</small></a>
<a rel=tag href=../../../tags/bfc/ class=tag-link-2 title="1 Posts">bfc<small>(2)</small></a>
<a rel=tag href=../../../tags/c/ class=tag-link-5 title="1 Posts">c<small>(5)</small></a>
<a rel=tag href=../../../tags/caffe/ class=tag-link-21 title="1 Posts">caffe<small>(21)</small></a>
<a rel=tag href=../../../tags/centos7/ class=tag-link-2 title="1 Posts">centos7<small>(2)</small></a>
<a rel=tag href=../../../tags/cgo/ class=tag-link-10 title="1 Posts">cgo<small>(10)</small></a>
<a rel=tag href=../../../tags/clang/ class=tag-link-42 title="1 Posts">clang<small>(42)</small></a>
<a rel=tag href=../../../tags/cmd/ class=tag-link-2 title="1 Posts">cmd<small>(2)</small></a>
<a rel=tag href=../../../tags/cpp/ class=tag-link-7 title="1 Posts">cpp<small>(7)</small></a>
<a rel=tag href=../../../tags/cross_compile/ class=tag-link-9 title="1 Posts">cross_compile<small>(9)</small></a>
<a rel=tag href=../../../tags/css/ class=tag-link-20 title="1 Posts">css<small>(20)</small></a>
<a rel=tag href=../../../tags/css3/ class=tag-link-2 title="1 Posts">css3<small>(2)</small></a>
<a rel=tag href=../../../tags/curd/ class=tag-link-3 title="1 Posts">curd<small>(3)</small></a>
<a rel=tag href=../../../tags/curl/ class=tag-link-2 title="1 Posts">curl<small>(2)</small></a>
<a rel=tag href=../../../tags/dataset/ class=tag-link-2 title="1 Posts">dataset<small>(2)</small></a>
<a rel=tag href=../../../tags/devops/ class=tag-link-3 title="1 Posts">devops<small>(3)</small></a>
<a rel=tag href=../../../tags/docker/ class=tag-link-21 title="1 Posts">docker<small>(21)</small></a>
<a rel=tag href=../../../tags/drone/ class=tag-link-22 title="1 Posts">drone<small>(22)</small></a>
<a rel=tag href=../../../tags/dts/ class=tag-link-6 title="1 Posts">dts<small>(6)</small></a>
<a rel=tag href=../../../tags/elasticsearch/ class=tag-link-9 title="1 Posts">elasticsearch<small>(9)</small></a>
<a rel=tag href=../../../tags/emacs/ class=tag-link-12 title="1 Posts">emacs<small>(12)</small></a>
<a rel=tag href=../../../tags/encode/ class=tag-link-3 title="1 Posts">encode<small>(3)</small></a>
<a rel=tag href=../../../tags/english/ class=tag-link-8 title="1 Posts">english<small>(8)</small></a>
<a rel=tag href=../../../tags/es6/ class=tag-link-2 title="1 Posts">es6<small>(2)</small></a>
<a rel=tag href=../../../tags/etcd/ class=tag-link-4 title="1 Posts">etcd<small>(4)</small></a>
<a rel=tag href=../../../tags/flannel/ class=tag-link-2 title="1 Posts">flannel<small>(2)</small></a>
<a rel=tag href=../../../tags/git/ class=tag-link-6 title="1 Posts">git<small>(6)</small></a>
<a rel=tag href=../../../tags/github/ class=tag-link-2 title="1 Posts">github<small>(2)</small></a>
<a rel=tag href=../../../tags/golang/ class=tag-link-150 title="1 Posts">golang<small>(150)</small></a>
<a rel=tag href=../../../tags/gradle/ class=tag-link-3 title="1 Posts">gradle<small>(3)</small></a>
<a rel=tag href=../../../tags/haproxy/ class=tag-link-5 title="1 Posts">haproxy<small>(5)</small></a>
<a rel=tag href=../../../tags/hardware/ class=tag-link-22 title="1 Posts">hardware<small>(22)</small></a>
<a rel=tag href=../../../tags/hexo/ class=tag-link-3 title="1 Posts">hexo<small>(3)</small></a>
<a rel=tag href=../../../tags/hi3519a/ class=tag-link-4 title="1 Posts">hi3519a<small>(4)</small></a>
<a rel=tag href=../../../tags/hisilicon/ class=tag-link-57 title="1 Posts">hisilicon<small>(57)</small></a>
<a rel=tag href=../../../tags/html/ class=tag-link-2 title="1 Posts">html<small>(2)</small></a>
<a rel=tag href=../../../tags/http/ class=tag-link-6 title="1 Posts">http<small>(6)</small></a>
<a rel=tag href=../../../tags/hugo/ class=tag-link-14 title="1 Posts">hugo<small>(14)</small></a>
<a rel=tag href=../../../tags/imagemagick/ class=tag-link-2 title="1 Posts">imagemagick<small>(2)</small></a>
<a rel=tag href=../../../tags/ip/ class=tag-link-3 title="1 Posts">ip<small>(3)</small></a>
<a rel=tag href=../../../tags/iproute2/ class=tag-link-5 title="1 Posts">iproute2<small>(5)</small></a>
<a rel=tag href=../../../tags/iptables/ class=tag-link-17 title="1 Posts">iptables<small>(17)</small></a>
<a rel=tag href=../../../tags/javascript/ class=tag-link-19 title="1 Posts">javascript<small>(19)</small></a>
<a rel=tag href=../../../tags/jetson/ class=tag-link-3 title="1 Posts">jetson<small>(3)</small></a>
<a rel=tag href=../../../tags/jquery/ class=tag-link-12 title="1 Posts">jquery<small>(12)</small></a>
<a rel=tag href=../../../tags/js/ class=tag-link-10 title="1 Posts">js<small>(10)</small></a>
<a rel=tag href=../../../tags/jumpserver/ class=tag-link-2 title="1 Posts">jumpserver<small>(2)</small></a>
<a rel=tag href=../../../tags/jwt/ class=tag-link-3 title="1 Posts">jwt<small>(3)</small></a>
<a rel=tag href=../../../tags/kernel/ class=tag-link-16 title="1 Posts">kernel<small>(16)</small></a>
<a rel=tag href=../../../tags/kubernetes/ class=tag-link-11 title="1 Posts">kubernetes<small>(11)</small></a>
<a rel=tag href=../../../tags/libev/ class=tag-link-3 title="1 Posts">libev<small>(3)</small></a>
<a rel=tag href=../../../tags/linux/ class=tag-link-22 title="1 Posts">linux<small>(22)</small></a>
<a rel=tag href=../../../tags/linux-system/ class=tag-link-8 title="1 Posts">linux-system<small>(8)</small></a>
<a rel=tag href=../../../tags/lvs/ class=tag-link-8 title="1 Posts">lvs<small>(8)</small></a>
<a rel=tag href=../../../tags/machinelearn/ class=tag-link-3 title="1 Posts">machinelearn<small>(3)</small></a>
<a rel=tag href=../../../tags/machinelearning/ class=tag-link-11 title="1 Posts">machinelearning<small>(11)</small></a>
<a rel=tag href=../../../tags/macos/ class=tag-link-14 title="1 Posts">macos<small>(14)</small></a>
<a rel=tag href=../../../tags/makefile/ class=tag-link-2 title="1 Posts">makefile<small>(2)</small></a>
<a rel=tag href=../../../tags/mariadb/ class=tag-link-9 title="1 Posts">mariadb<small>(9)</small></a>
<a rel=tag href=../../../tags/math/ class=tag-link-7 title="1 Posts">math<small>(7)</small></a>
<a rel=tag href=../../../tags/matplotlib/ class=tag-link-3 title="1 Posts">matplotlib<small>(3)</small></a>
<a rel=tag href=../../../tags/maven/ class=tag-link-2 title="1 Posts">maven<small>(2)</small></a>
<a rel=tag href=../../../tags/meteor/ class=tag-link-7 title="1 Posts">meteor<small>(7)</small></a>
<a rel=tag href=../../../tags/ml/ class=tag-link-3 title="1 Posts">ml<small>(3)</small></a>
<a rel=tag href=../../../tags/mpp/ class=tag-link-12 title="1 Posts">mpp<small>(12)</small></a>
<a rel=tag href=../../../tags/mysql/ class=tag-link-61 title="1 Posts">mysql<small>(61)</small></a>
<a rel=tag href=../../../tags/ncnn/ class=tag-link-3 title="1 Posts">ncnn<small>(3)</small></a>
<a rel=tag href=../../../tags/netns/ class=tag-link-2 title="1 Posts">netns<small>(2)</small></a>
<a rel=tag href=../../../tags/network/ class=tag-link-2 title="1 Posts">network<small>(2)</small></a>
<a rel=tag href=../../../tags/nginx/ class=tag-link-28 title="1 Posts">nginx<small>(28)</small></a>
<a rel=tag href=../../../tags/nmap/ class=tag-link-2 title="1 Posts">nmap<small>(2)</small></a>
<a rel=tag href=../../../tags/nnie/ class=tag-link-6 title="1 Posts">nnie<small>(6)</small></a>
<a rel=tag href=../../../tags/node/ class=tag-link-4 title="1 Posts">node<small>(4)</small></a>
<a rel=tag href=../../../tags/nosql/ class=tag-link-8 title="1 Posts">nosql<small>(8)</small></a>
<a rel=tag href=../../../tags/npm/ class=tag-link-3 title="1 Posts">npm<small>(3)</small></a>
<a rel=tag href=../../../tags/numpy/ class=tag-link-4 title="1 Posts">numpy<small>(4)</small></a>
<a rel=tag href=../../../tags/oauth2/ class=tag-link-2 title="1 Posts">oauth2<small>(2)</small></a>
<a rel=tag href=../../../tags/opencv/ class=tag-link-10 title="1 Posts">opencv<small>(10)</small></a>
<a rel=tag href=../../../tags/openssl/ class=tag-link-3 title="1 Posts">openssl<small>(3)</small></a>
<a rel=tag href=../../../tags/pandoc/ class=tag-link-2 title="1 Posts">pandoc<small>(2)</small></a>
<a rel=tag href=../../../tags/php/ class=tag-link-4 title="1 Posts">php<small>(4)</small></a>
<a rel=tag href=../../../tags/post/ class=tag-link-4 title="1 Posts">post<small>(4)</small></a>
<a rel=tag href=../../../tags/powershell/ class=tag-link-2 title="1 Posts">powershell<small>(2)</small></a>
<a rel=tag href=../../../tags/prometheus/ class=tag-link-8 title="1 Posts">prometheus<small>(8)</small></a>
<a rel=tag href=../../../tags/pyqt/ class=tag-link-8 title="1 Posts">pyqt<small>(8)</small></a>
<a rel=tag href=../../../tags/python/ class=tag-link-33 title="1 Posts">python<small>(33)</small></a>
<a rel=tag href=../../../tags/pytorch/ class=tag-link-6 title="1 Posts">pytorch<small>(6)</small></a>
<a rel=tag href=../../../tags/raspi/ class=tag-link-4 title="1 Posts">raspi<small>(4)</small></a>
<a rel=tag href=../../../tags/redis/ class=tag-link-2 title="1 Posts">redis<small>(2)</small></a>
<a rel=tag href=../../../tags/reflect/ class=tag-link-3 title="1 Posts">reflect<small>(3)</small></a>
<a rel=tag href=../../../tags/responsive/ class=tag-link-2 title="1 Posts">responsive<small>(2)</small></a>
<a rel=tag href=../../../tags/restful/ class=tag-link-6 title="1 Posts">restful<small>(6)</small></a>
<a rel=tag href=../../../tags/rk3288/ class=tag-link-22 title="1 Posts">rk3288<small>(22)</small></a>
<a rel=tag href=../../../tags/rk3399/ class=tag-link-9 title="1 Posts">rk3399<small>(9)</small></a>
<a rel=tag href=../../../tags/route/ class=tag-link-2 title="1 Posts">route<small>(2)</small></a>
<a rel=tag href=../../../tags/rsync/ class=tag-link-2 title="1 Posts">rsync<small>(2)</small></a>
<a rel=tag href=../../../tags/rtmp/ class=tag-link-2 title="1 Posts">rtmp<small>(2)</small></a>
<a rel=tag href=../../../tags/scikit/ class=tag-link-3 title="1 Posts">scikit<small>(3)</small></a>
<a rel=tag href=../../../tags/scrapy/ class=tag-link-8 title="1 Posts">scrapy<small>(8)</small></a>
<a rel=tag href=../../../tags/scss/ class=tag-link-2 title="1 Posts">scss<small>(2)</small></a>
<a rel=tag href=../../../tags/sed/ class=tag-link-3 title="1 Posts">sed<small>(3)</small></a>
<a rel=tag href=../../../tags/seo/ class=tag-link-5 title="1 Posts">seo<small>(5)</small></a>
<a rel=tag href=../../../tags/shell/ class=tag-link-11 title="1 Posts">shell<small>(11)</small></a>
<a rel=tag href=../../../tags/socket/ class=tag-link-5 title="1 Posts">socket<small>(5)</small></a>
<a rel=tag href=../../../tags/sqlite/ class=tag-link-2 title="1 Posts">sqlite<small>(2)</small></a>
<a rel=tag href=../../../tags/ssh/ class=tag-link-3 title="1 Posts">ssh<small>(3)</small></a>
<a rel=tag href=../../../tags/stm32/ class=tag-link-11 title="1 Posts">stm32<small>(11)</small></a>
<a rel=tag href=../../../tags/stm8/ class=tag-link-9 title="1 Posts">stm8<small>(9)</small></a>
<a rel=tag href=../../../tags/swagger/ class=tag-link-2 title="1 Posts">swagger<small>(2)</small></a>
<a rel=tag href=../../../tags/swarm/ class=tag-link-2 title="1 Posts">swarm<small>(2)</small></a>
<a rel=tag href=../../../tags/sysbench/ class=tag-link-2 title="1 Posts">sysbench<small>(2)</small></a>
<a rel=tag href=../../../tags/sysctl/ class=tag-link-2 title="1 Posts">sysctl<small>(2)</small></a>
<a rel=tag href=../../../tags/systemctl/ class=tag-link-2 title="1 Posts">systemctl<small>(2)</small></a>
<a rel=tag href=../../../tags/tc/ class=tag-link-2 title="1 Posts">tc<small>(2)</small></a>
<a rel=tag href=../../../tags/tcpdump/ class=tag-link-2 title="1 Posts">tcpdump<small>(2)</small></a>
<a rel=tag href=../../../tags/timezone/ class=tag-link-2 title="1 Posts">timezone<small>(2)</small></a>
<a rel=tag href=../../../tags/tshark/ class=tag-link-2 title="1 Posts">tshark<small>(2)</small></a>
<a rel=tag href=../../../tags/ubuntu/ class=tag-link-2 title="1 Posts">ubuntu<small>(2)</small></a>
<a rel=tag href=../../../tags/ulimit/ class=tag-link-2 title="1 Posts">ulimit<small>(2)</small></a>
<a rel=tag href=../../../tags/vim/ class=tag-link-14 title="1 Posts">vim<small>(14)</small></a>
<a rel=tag href=../../../tags/webpack3/ class=tag-link-2 title="1 Posts">webpack3<small>(2)</small></a>
<a rel=tag href=../../../tags/windows/ class=tag-link-18 title="1 Posts">windows<small>(18)</small></a>
<a rel=tag href=../../../tags/wireshark/ class=tag-link-2 title="1 Posts">wireshark<small>(2)</small></a>
<a rel=tag href=../../../tags/xidel/ class=tag-link-2 title="1 Posts">xidel<small>(2)</small></a>
<a rel=tag href=../../../tags/xml/ class=tag-link-2 title="1 Posts">xml<small>(2)</small></a>
<a rel=tag href=../../../tags/yaml/ class=tag-link-2 title="1 Posts">yaml<small>(2)</small></a>
<a rel=tag href=../../../tags/yolo/ class=tag-link-16 title="1 Posts">yolo<small>(16)</small></a>
<a rel=tag href=../../../tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class=tag-link-2 title="1 Posts">微服务<small>(2)</small></a></div></div></div></div>`</div></div></div></div></div><script>var HUParams={"_disabled":[],"SmoothScroll":{"Enabled":true,"Options":{"touchpadSupport":false}},"centerAllImg":"1","timerOnScrollAllBrowsers":"1","extLinksStyle":"1","extLinksTargetExt":"1","extLinksSkipSelectors":{"classes":["btn","button"],"ids":[]},"imgSmartLoadEnabled":"1","imgSmartLoadOpts":{"parentSelectors":[".container .content",".container .sidebar","#footer","#header-widgets"],"opts":{"excludeImg":[".tc-holder-img"],"fadeIn_options":100}},"goldenRatio":"1.618","gridGoldenRatioLimit":"350","sbStickyUserSettings":{"desktop":true,"mobile":true},"isWPMobile":"","menuStickyUserSettings":{"desktop":"stick_up","mobile":"stick_up"},"isDevMode":"","ajaxUrl":"https:\/\/demo-hueman.presscustomizr.com\/?huajax=1","frontNonce":{"id":"HuFrontNonce","handle":"798e5956c0"},"userStarted":{"with":"before|1.0.4","on":{"date":"2017-05-22 16:30:22.000000","timezone_type":3,"timezone":"UTC"}},"isWelcomeNoteOn":"","welcomeContent":""};</script><script src=https://cdn.bootcss.com/lodash-compat/3.10.2/lodash.min.js></script><script src=https://cdn.bootcss.com/jquery/1.9.0/jquery.min.js></script><script src=../../../front/js/scripts.js></script><footer id=footer><section class=container id=footer-bottom><div class=container-inner><a id=back-to-top href=#><i class="fa fa-angle-up"></i></a><div class="pad group"><div class="grid one-half"><div id=copyright><p>Copyright (c) 2017. All rights reserved. (版权所有) <a href=http://www.miitbeian.gov.cn/>鲁ICP备17074587号-1</a></div></div><div class="grid one-half last"><ul class=social-links><li><a class=social-tooltip title="On WeiBo" href=http://weibo.com/rinetd target=_blank><i class="fa fa-weibo"></i></a><li><a class=social-tooltip title="On Twitter" href=https://twitter.com/rinetd target=_blank><i class="fa fa-twitter"></i></a><li><a class=social-tooltip title="On GitHub" href=https://github.com/rinetd target=_blank><i class="fa fa-github"></i></a></ul></div></div></div></section></footer><div class=back-to-top id=back-to-top><i class="fa fa-angle-double-up"></i></div><script>$(".topbar-toggle-down").click(function(){$("#nav-topbar").css("overflow","visible");});</script><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5HM5XM2" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-5HM5XM2');</script>